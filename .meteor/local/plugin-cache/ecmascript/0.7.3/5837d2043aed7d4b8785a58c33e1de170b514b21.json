{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"/client/api","imported":["Reaction","i18next"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"},{"kind":"named","imported":"i18next","local":"i18next"}]},{"source":"/lib/api","imported":["ReactionProduct"],"specifiers":[{"kind":"named","imported":"ReactionProduct","local":"ReactionProduct"}]},{"source":"/lib/collections","imported":["Media"],"specifiers":[{"kind":"named","imported":"Media","local":"Media"}]},{"source":"/imports/plugins/core/ui/client/components","imported":["Icon"],"specifiers":[{"kind":"named","imported":"Icon","local":"Icon"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js","filenameRelative":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js"],"names":["Reaction","i18next","ReactionProduct","Media","Icon","productHandle","selectedProduct","__published","handle","Template","onRendered","autorun","selectedVariantId","Router","getParam","$","collapse","focus","childVariantForm","helpers","childVariantFormId","_id","media","find","sort","featuredMedia","findOne","handleFileUpload","ownerId","Meteor","userId","productId","selectedProductId","shopId","getShopId","currentData","variantId","files","file","metadata","insert","active","events","event","template","data","go","setCurrentVariant","variant","value","instance","currentTarget","val","field","attr","call","error","Error","stopPropagation","preventDefault","title","optionTitle","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","result","text","defaultValue"],"mappings":"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","file":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js.map","sourcesContent":["import { Reaction, i18next } from \"/client/api\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Media } from \"/lib/collections\";\nimport { Icon } from \"/imports/plugins/core/ui/client/components\";\n\nfunction productHandle() {\n  const selectedProduct = ReactionProduct.selectedProduct();\n  return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n}\n/**\n * childVariantForm onRendered\n */\nTemplate.onRendered(function () {\n  this.autorun(() => {\n    const selectedVariantId = Reaction.Router.getParam(\"variantId\");\n\n    $(`div.child-variant-collapse:not(#child-variant-form-${selectedVariantId})`).collapse(\"hide\");\n    $(`#child-variant-form-${selectedVariantId}`).collapse(\"show\");\n    $(`#option-child-variant-form-${selectedVariantId}`).focus();\n  });\n});\n\n/**\n * childVariantForm helpers\n */\n\nTemplate.childVariantForm.helpers({\n  Icon() {\n    return Icon;\n  },\n  childVariantFormId: function () {\n    return \"child-variant-form-\" + this._id;\n  },\n  media: function () {\n    const media = Media.find({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n\n    return media;\n  },\n  featuredMedia: function () {\n    const media = Media.findOne({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n\n    if (media) {\n      return [media];\n    }\n\n    return false;\n  },\n  handleFileUpload() {\n    const ownerId = Meteor.userId();\n    const productId = ReactionProduct.selectedProductId();\n    const shopId = Reaction.getShopId();\n    const currentData = Template.currentData();\n    const variantId = currentData._id;\n\n    return (files) => {\n      for (const file of files) {\n        file.metadata = {\n          variantId,\n          productId,\n          shopId,\n          ownerId\n        };\n\n        Media.insert(file);\n      }\n    };\n  },\n  active() {\n    const variantId = ReactionProduct.selectedVariantId();\n\n    if (variantId === this._id) {\n      return \"panel-active\";\n    }\n\n    return \"panel-default\";\n  }\n});\n\n/**\n * childVariantForm events\n */\n\nTemplate.childVariantForm.events({\n  \"click .child-variant-form :input, click li\": function (event, template) {\n    const variantId = template.data._id;\n\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n\n    return ReactionProduct.setCurrentVariant(template.data._id);\n  },\n  \"change .child-variant-input\": function (event, template) {\n    const variant = template.data;\n    const value = Template.instance().$(event.currentTarget).val();\n    const field = Template.instance().$(event.currentTarget).attr(\"name\");\n\n    Meteor.call(\"products/updateProductField\", variant._id, field, value,\n      error => {\n        if (error) {\n          throw new Meteor.Error(\"error updating variant\", error);\n        }\n      });\n    return ReactionProduct.setCurrentVariant(variant._id);\n  },\n  \"click .js-child-variant-heading\": function (event, instance) {\n    const variantId = instance.data._id;\n\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n  },\n\n  \"click .js-remove-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    const title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Archive\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = instance.data._id;\n        Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n          // TODO why we have this on option remove?\n          if (result && ReactionProduct.selectedVariantId() === id) {\n            ReactionProduct.setCurrentVariant(null);\n          }\n        });\n      }\n    });\n  },\n\n  \"click .js-restore-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    const title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Restore\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = instance.data._id;\n        Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n              confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n            });\n          }\n        });\n      }\n    });\n  }\n});\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js.map","sourceFileName":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"childVariant"},"ignored":false,"code":"var Reaction = void 0,\n    i18next = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 0);\nvar ReactionProduct = void 0;\nmodule.importSync(\"/lib/api\", {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 1);\nvar Media = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Media: function (v) {\n    Media = v;\n  }\n}, 2);\nvar Icon = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/components\", {\n  Icon: function (v) {\n    Icon = v;\n  }\n}, 3);\n\nfunction productHandle() {\n  var selectedProduct = ReactionProduct.selectedProduct();\n  return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n} /**\n   * childVariantForm onRendered\n   */\n\nTemplate.onRendered(function () {\n  this.autorun(function () {\n    var selectedVariantId = Reaction.Router.getParam(\"variantId\");\n    $(\"div.child-variant-collapse:not(#child-variant-form-\" + selectedVariantId + \")\").collapse(\"hide\");\n    $(\"#child-variant-form-\" + selectedVariantId).collapse(\"show\");\n    $(\"#option-child-variant-form-\" + selectedVariantId).focus();\n  });\n}); /**\n     * childVariantForm helpers\n     */\nTemplate.childVariantForm.helpers({\n  Icon: function () {\n    return Icon;\n  },\n  childVariantFormId: function () {\n    return \"child-variant-form-\" + this._id;\n  },\n  media: function () {\n    var media = Media.find({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n    return media;\n  },\n  featuredMedia: function () {\n    var media = Media.findOne({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n\n    if (media) {\n      return [media];\n    }\n\n    return false;\n  },\n  handleFileUpload: function () {\n    var ownerId = Meteor.userId();\n    var productId = ReactionProduct.selectedProductId();\n    var shopId = Reaction.getShopId();\n    var currentData = Template.currentData();\n    var variantId = currentData._id;\n    return function (files) {\n      for (var _iterator = files, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n        var _ref;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref = _i.value;\n        }\n\n        var file = _ref;\n        file.metadata = {\n          variantId: variantId,\n          productId: productId,\n          shopId: shopId,\n          ownerId: ownerId\n        };\n        Media.insert(file);\n      }\n    };\n  },\n  active: function () {\n    var variantId = ReactionProduct.selectedVariantId();\n\n    if (variantId === this._id) {\n      return \"panel-active\";\n    }\n\n    return \"panel-default\";\n  }\n}); /**\n     * childVariantForm events\n     */\nTemplate.childVariantForm.events({\n  \"click .child-variant-form :input, click li\": function (event, template) {\n    var variantId = template.data._id;\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n    return ReactionProduct.setCurrentVariant(template.data._id);\n  },\n  \"change .child-variant-input\": function (event, template) {\n    var variant = template.data;\n    var value = Template.instance().$(event.currentTarget).val();\n    var field = Template.instance().$(event.currentTarget).attr(\"name\");\n    Meteor.call(\"products/updateProductField\", variant._id, field, value, function (error) {\n      if (error) {\n        throw new Meteor.Error(\"error updating variant\", error);\n      }\n    });\n    return ReactionProduct.setCurrentVariant(variant._id);\n  },\n  \"click .js-child-variant-heading\": function (event, instance) {\n    var variantId = instance.data._id;\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n  },\n  \"click .js-remove-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    var title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", {\n        title: title\n      }),\n      showCancelButton: true,\n      confirmButtonText: \"Archive\"\n    }, function (isConfirm) {\n      if (isConfirm) {\n        var id = instance.data._id;\n        Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n          // TODO why we have this on option remove?\n          if (result && ReactionProduct.selectedVariantId() === id) {\n            ReactionProduct.setCurrentVariant(null);\n          }\n        });\n      }\n    });\n  },\n  \"click .js-restore-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    var title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", {\n        title: title\n      }),\n      showCancelButton: true,\n      confirmButtonText: \"Restore\"\n    }, function (isConfirm) {\n      if (isConfirm) {\n        var id = instance.data._id;\n        Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, function (error) {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.restoreVariantFail\", {\n                title: title\n              }),\n              confirmButtonText: i18next.t(\"app.close\", {\n                defaultValue: \"Close\"\n              })\n            });\n          }\n        });\n      }\n    });\n  }\n});","map":{"version":3,"sources":["/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js"],"names":["Reaction","i18next","ReactionProduct","Media","Icon","productHandle","selectedProduct","__published","handle","Template","onRendered","autorun","selectedVariantId","Router","getParam","$","collapse","focus","childVariantForm","helpers","childVariantFormId","_id","media","find","sort","featuredMedia","findOne","handleFileUpload","ownerId","Meteor","userId","productId","selectedProductId","shopId","getShopId","currentData","variantId","files","file","metadata","insert","active","events","event","template","data","go","setCurrentVariant","variant","value","instance","currentTarget","val","field","attr","call","error","Error","stopPropagation","preventDefault","title","optionTitle","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","result","text","defaultValue"],"mappings":"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","file":"/imports/plugins/included/product-variant/client/templates/products/productDetail/variants/variantForm/childVariant.js.map","sourcesContent":["import { Reaction, i18next } from \"/client/api\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Media } from \"/lib/collections\";\nimport { Icon } from \"/imports/plugins/core/ui/client/components\";\n\nfunction productHandle() {\n  const selectedProduct = ReactionProduct.selectedProduct();\n  return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n}\n/**\n * childVariantForm onRendered\n */\nTemplate.onRendered(function () {\n  this.autorun(() => {\n    const selectedVariantId = Reaction.Router.getParam(\"variantId\");\n\n    $(`div.child-variant-collapse:not(#child-variant-form-${selectedVariantId})`).collapse(\"hide\");\n    $(`#child-variant-form-${selectedVariantId}`).collapse(\"show\");\n    $(`#option-child-variant-form-${selectedVariantId}`).focus();\n  });\n});\n\n/**\n * childVariantForm helpers\n */\n\nTemplate.childVariantForm.helpers({\n  Icon() {\n    return Icon;\n  },\n  childVariantFormId: function () {\n    return \"child-variant-form-\" + this._id;\n  },\n  media: function () {\n    const media = Media.find({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n\n    return media;\n  },\n  featuredMedia: function () {\n    const media = Media.findOne({\n      \"metadata.variantId\": this._id\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    });\n\n    if (media) {\n      return [media];\n    }\n\n    return false;\n  },\n  handleFileUpload() {\n    const ownerId = Meteor.userId();\n    const productId = ReactionProduct.selectedProductId();\n    const shopId = Reaction.getShopId();\n    const currentData = Template.currentData();\n    const variantId = currentData._id;\n\n    return (files) => {\n      for (const file of files) {\n        file.metadata = {\n          variantId,\n          productId,\n          shopId,\n          ownerId\n        };\n\n        Media.insert(file);\n      }\n    };\n  },\n  active() {\n    const variantId = ReactionProduct.selectedVariantId();\n\n    if (variantId === this._id) {\n      return \"panel-active\";\n    }\n\n    return \"panel-default\";\n  }\n});\n\n/**\n * childVariantForm events\n */\n\nTemplate.childVariantForm.events({\n  \"click .child-variant-form :input, click li\": function (event, template) {\n    const variantId = template.data._id;\n\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n\n    return ReactionProduct.setCurrentVariant(template.data._id);\n  },\n  \"change .child-variant-input\": function (event, template) {\n    const variant = template.data;\n    const value = Template.instance().$(event.currentTarget).val();\n    const field = Template.instance().$(event.currentTarget).attr(\"name\");\n\n    Meteor.call(\"products/updateProductField\", variant._id, field, value,\n      error => {\n        if (error) {\n          throw new Meteor.Error(\"error updating variant\", error);\n        }\n      });\n    return ReactionProduct.setCurrentVariant(variant._id);\n  },\n  \"click .js-child-variant-heading\": function (event, instance) {\n    const variantId = instance.data._id;\n\n    Reaction.Router.go(\"product\", {\n      handle: productHandle(),\n      variantId: variantId\n    });\n  },\n\n  \"click .js-remove-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    const title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Archive\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = instance.data._id;\n        Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n          // TODO why we have this on option remove?\n          if (result && ReactionProduct.selectedVariantId() === id) {\n            ReactionProduct.setCurrentVariant(null);\n          }\n        });\n      }\n    });\n  },\n\n  \"click .js-restore-child-variant\": function (event, instance) {\n    event.stopPropagation();\n    event.preventDefault();\n    const title = instance.data.optionTitle || i18next.t(\"productDetailEdit.thisOption\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Restore\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = instance.data._id;\n        Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n              confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n            });\n          }\n        });\n      }\n    });\n  }\n});\n"]},"hash":"5837d2043aed7d4b8785a58c33e1de170b514b21"}
