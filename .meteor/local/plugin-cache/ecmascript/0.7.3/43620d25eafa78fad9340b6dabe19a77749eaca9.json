{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","typeof","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component","PropTypes"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"},{"kind":"named","imported":"PropTypes","local":"PropTypes"}]},{"source":"lodash/debounce","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"debounce"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"/imports/plugins/core/ui/client/components","imported":["Translation"],"specifiers":[{"kind":"named","imported":"Translation","local":"Translation"}]}],"exports":{"exported":["DiscountForm"],"specifiers":[{"kind":"local","local":"DiscountForm","exported":"default"}]}}},"options":{"filename":"/imports/plugins/core/discounts/client/components/form.js","filenameRelative":"/imports/plugins/core/discounts/client/components/form.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/core/discounts/client/components/form.js"],"names":["React","Component","PropTypes","debounce","Meteor","Translation","DiscountForm","constructor","props","state","discount","validationMessage","validatedInput","attempts","discountApplied","debounceDiscounts","setState","call","id","collection","error","result","timerId","setTimeout","bind","handleChange","handleClick","componentWillUnmount","clearInterval","renderApplied","event","keyCode","preventDefault","stopPropagation","target","value","loader","i18nKeyLabel","i18nKey","length","renderDiscountForm","renderDiscountLink","render","propTypes","string","bool"],"mappings":"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","file":"/imports/plugins/core/discounts/client/components/form.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport debounce from \"lodash/debounce\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Translation } from \"/imports/plugins/core/ui/client/components\";\n\nexport default class DiscountForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      discount: this.props.discount,\n      validationMessage: null,\n      validatedInput: this.props.validatedInput || false,\n      attempts: 0,\n      discountApplied: false\n    };\n    // debounce helper so to wait on user input\n    this.debounceDiscounts = debounce(() => {\n      this.setState({ validationMessage: \"\" });\n      const { discount } = this.state;\n      // handle discount code validation messages after attempt to apply\n      Meteor.call(\"discounts/codes/apply\", this.props.id, discount, this.props.collection, (error, result) => {\n        if (typeof result === \"object\") {\n          this.setState({ validationMessage: result });\n        } else if (result !== 1) {\n            // if validationMessage isn't an object with i18n\n            // we will display an elliptical that's not\n            // actually done here though, just bit of foolery\n          this.timerId = Meteor.setTimeout(function () {\n            this.setState({ validationMessage: \"...\" });\n          }.bind(this), 2000);\n        }\n      });\n    }, 800);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentWillUnmount() {\n    if (this.timerId) Meteor.clearInterval(this.timerId);\n  }\n\n  // handle apply\n  renderApplied() {\n    return (\n      <a onClick={this.handleClick}>\n        <Translation defaultValue=\"Discount submitted.\" i18nKey=\"discounts.submitted\"/>\n      </a>\n    );\n  }\n\n  // handle keydown and change events\n  handleChange(event) {\n    const { attempts } = this.state;\n    // ensure we don't submit on enter\n    if (event.keyCode === 13) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    // clear input if user hits escape key\n    if (event.keyCode === 27) {\n      return this.setState({ discount: \"\", validatedInput: false, attempts: 0, discountApplied: false, validationMessage: null });\n    }\n    this.setState({\n      discount: event.target.value,\n      attempts: attempts + 1\n    });\n    // TODO: this.debounce doesn't always need to exec we should add some logic to determine based on attempts or some other\n    // cleverness if now is a good time to apply the code.\n    this.debounceDiscounts();\n  }\n\n  // handle display or not\n  handleClick(event) {\n    event.preventDefault();\n    this.setState({ validatedInput: true });\n  }\n\n  // loader button\n  loader() {\n    const { attempts, discount, validationMessage } = this.state;\n    let loader;\n    if (validationMessage && validationMessage.i18nKeyLabel && attempts > 3) {\n      loader = <Translation defaultValue={validationMessage.i18nKeyLabel} i18nKey={validationMessage.i18nKey}/>;\n    } else if (validationMessage) {\n      loader = <i className=\"fa fa-ellipsis-h fa-fw\"/>;\n    } else {\n      if (discount && discount.length >= 10 && attempts >= 12) {\n        loader = <i className=\"fa fa-stop-circle fa-fw\"/>;\n      } else if (discount && discount.length >= 2 && attempts >= 2) {\n        loader = <i className=\"fa fa-circle-o-notch fa-spin fa-fw\"/>;\n      } else {\n        loader = <i className=\"fa fa-search fa-fw\"/>;\n      }\n    }\n\n    return loader;\n  }\n\n  // render discount form\n  renderDiscountForm() {\n    return (\n      <form>\n        <label htmlFor=\"discount-url\">\n          <Translation defaultValue=\"Discount Code\" i18nKey=\"discounts.discountLabel\"/>\n        </label>\n        <div className=\"input-group\">\n          <input\n            autoFocus\n            onChange={this.handleChange}\n            onKeyDown={this.handleChange}\n            className=\"form-control\"\n            id=\"discount-input\"\n            aria-describedby=\"discount-input-addon\"\n          />\n          <span className=\"input-group-addon\" id=\"discount-input-addon\">\n            {this.loader()}\n          </span>\n        </div>\n      </form>\n    );\n  }\n  // have a code link\n  renderDiscountLink() {\n    return (\n      <a onClick={this.handleClick}>\n        <Translation defaultValue=\"Have a code? Enter it here.\" i18nKey=\"discounts.enterItHere\"/>\n      </a>\n    );\n  }\n\n  // render discount code input form\n  render() {\n    const { discountApplied, validatedInput } = this.state;\n    if (discountApplied === true && validatedInput === true) {\n      return this.renderApplied();\n    } else if (validatedInput === true) {\n      return this.renderDiscountForm();\n    }\n    return this.renderDiscountLink();\n  }\n}\n\nDiscountForm.propTypes = {\n  collection: PropTypes.string,\n  discount: PropTypes.string,\n  id: PropTypes.string,\n  validatedInput: PropTypes.bool\n};\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/core/discounts/client/components/form.js.map","sourceFileName":"/imports/plugins/core/discounts/client/components/form.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"form"},"ignored":false,"code":"var _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nmodule.export({\n  \"default\": function () {\n    return DiscountForm;\n  }\n});\nvar React = void 0,\n    Component = void 0,\n    PropTypes = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  }\n}, 0);\nvar debounce = void 0;\nmodule.importSync(\"lodash/debounce\", {\n  \"default\": function (v) {\n    debounce = v;\n  }\n}, 1);\nvar Meteor = void 0;\nmodule.importSync(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Translation = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/components\", {\n  Translation: function (v) {\n    Translation = v;\n  }\n}, 3);\n\nvar DiscountForm = function (_Component) {\n  (0, _inherits3.default)(DiscountForm, _Component);\n\n  function DiscountForm(props) {\n    (0, _classCallCheck3.default)(this, DiscountForm);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.state = {\n      discount: _this.props.discount,\n      validationMessage: null,\n      validatedInput: _this.props.validatedInput || false,\n      attempts: 0,\n      discountApplied: false\n    }; // debounce helper so to wait on user input\n\n    _this.debounceDiscounts = debounce(function () {\n      _this.setState({\n        validationMessage: \"\"\n      });\n\n      var discount = _this.state.discount; // handle discount code validation messages after attempt to apply\n\n      Meteor.call(\"discounts/codes/apply\", _this.props.id, discount, _this.props.collection, function (error, result) {\n        if ((typeof result === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(result)) === \"object\") {\n          _this.setState({\n            validationMessage: result\n          });\n        } else if (result !== 1) {\n          // if validationMessage isn't an object with i18n\n          // we will display an elliptical that's not\n          // actually done here though, just bit of foolery\n          _this.timerId = Meteor.setTimeout(function () {\n            this.setState({\n              validationMessage: \"...\"\n            });\n          }.bind(_this), 2000);\n        }\n      });\n    }, 800);\n    _this.handleChange = _this.handleChange.bind(_this);\n    _this.handleClick = _this.handleClick.bind(_this);\n    return _this;\n  }\n\n  DiscountForm.prototype.componentWillUnmount = function () {\n    function componentWillUnmount() {\n      if (this.timerId) Meteor.clearInterval(this.timerId);\n    }\n\n    return componentWillUnmount;\n  }(); // handle apply\n\n\n  DiscountForm.prototype.renderApplied = function () {\n    function renderApplied() {\n      return React.createElement(\n        \"a\",\n        {\n          onClick: this.handleClick\n        },\n        React.createElement(Translation, {\n          defaultValue: \"Discount submitted.\",\n          i18nKey: \"discounts.submitted\"\n        })\n      );\n    }\n\n    return renderApplied;\n  }(); // handle keydown and change events\n\n\n  DiscountForm.prototype.handleChange = function () {\n    function handleChange(event) {\n      var attempts = this.state.attempts; // ensure we don't submit on enter\n\n      if (event.keyCode === 13) {\n        event.preventDefault();\n        event.stopPropagation();\n      } // clear input if user hits escape key\n\n\n      if (event.keyCode === 27) {\n        return this.setState({\n          discount: \"\",\n          validatedInput: false,\n          attempts: 0,\n          discountApplied: false,\n          validationMessage: null\n        });\n      }\n\n      this.setState({\n        discount: event.target.value,\n        attempts: attempts + 1\n      }); // TODO: this.debounce doesn't always need to exec we should add some logic to determine based on attempts or some other\n      // cleverness if now is a good time to apply the code.\n\n      this.debounceDiscounts();\n    }\n\n    return handleChange;\n  }(); // handle display or not\n\n\n  DiscountForm.prototype.handleClick = function () {\n    function handleClick(event) {\n      event.preventDefault();\n      this.setState({\n        validatedInput: true\n      });\n    }\n\n    return handleClick;\n  }(); // loader button\n\n\n  DiscountForm.prototype.loader = function () {\n    function loader() {\n      var _state = this.state,\n          attempts = _state.attempts,\n          discount = _state.discount,\n          validationMessage = _state.validationMessage;\n      var loader = void 0;\n\n      if (validationMessage && validationMessage.i18nKeyLabel && attempts > 3) {\n        loader = React.createElement(Translation, {\n          defaultValue: validationMessage.i18nKeyLabel,\n          i18nKey: validationMessage.i18nKey\n        });\n      } else if (validationMessage) {\n        loader = React.createElement(\"i\", {\n          className: \"fa fa-ellipsis-h fa-fw\"\n        });\n      } else {\n        if (discount && discount.length >= 10 && attempts >= 12) {\n          loader = React.createElement(\"i\", {\n            className: \"fa fa-stop-circle fa-fw\"\n          });\n        } else if (discount && discount.length >= 2 && attempts >= 2) {\n          loader = React.createElement(\"i\", {\n            className: \"fa fa-circle-o-notch fa-spin fa-fw\"\n          });\n        } else {\n          loader = React.createElement(\"i\", {\n            className: \"fa fa-search fa-fw\"\n          });\n        }\n      }\n\n      return loader;\n    }\n\n    return loader;\n  }(); // render discount form\n\n\n  DiscountForm.prototype.renderDiscountForm = function () {\n    function renderDiscountForm() {\n      return React.createElement(\n        \"form\",\n        null,\n        React.createElement(\n          \"label\",\n          {\n            htmlFor: \"discount-url\"\n          },\n          React.createElement(Translation, {\n            defaultValue: \"Discount Code\",\n            i18nKey: \"discounts.discountLabel\"\n          })\n        ),\n        React.createElement(\n          \"div\",\n          {\n            className: \"input-group\"\n          },\n          React.createElement(\"input\", {\n            autoFocus: true,\n            onChange: this.handleChange,\n            onKeyDown: this.handleChange,\n            className: \"form-control\",\n            id: \"discount-input\",\n            \"aria-describedby\": \"discount-input-addon\"\n          }),\n          React.createElement(\n            \"span\",\n            {\n              className: \"input-group-addon\",\n              id: \"discount-input-addon\"\n            },\n            this.loader()\n          )\n        )\n      );\n    }\n\n    return renderDiscountForm;\n  }(); // have a code link\n\n\n  DiscountForm.prototype.renderDiscountLink = function () {\n    function renderDiscountLink() {\n      return React.createElement(\n        \"a\",\n        {\n          onClick: this.handleClick\n        },\n        React.createElement(Translation, {\n          defaultValue: \"Have a code? Enter it here.\",\n          i18nKey: \"discounts.enterItHere\"\n        })\n      );\n    }\n\n    return renderDiscountLink;\n  }(); // render discount code input form\n\n\n  DiscountForm.prototype.render = function () {\n    function render() {\n      var _state2 = this.state,\n          discountApplied = _state2.discountApplied,\n          validatedInput = _state2.validatedInput;\n\n      if (discountApplied === true && validatedInput === true) {\n        return this.renderApplied();\n      } else if (validatedInput === true) {\n        return this.renderDiscountForm();\n      }\n\n      return this.renderDiscountLink();\n    }\n\n    return render;\n  }();\n\n  return DiscountForm;\n}(Component);\n\nDiscountForm.propTypes = {\n  collection: PropTypes.string,\n  discount: PropTypes.string,\n  id: PropTypes.string,\n  validatedInput: PropTypes.bool\n};","map":{"version":3,"sources":["/imports/plugins/core/discounts/client/components/form.js"],"names":["React","Component","PropTypes","debounce","Meteor","Translation","DiscountForm","constructor","props","state","discount","validationMessage","validatedInput","attempts","discountApplied","debounceDiscounts","setState","call","id","collection","error","result","timerId","setTimeout","bind","handleChange","handleClick","componentWillUnmount","clearInterval","renderApplied","event","keyCode","preventDefault","stopPropagation","target","value","loader","i18nKeyLabel","i18nKey","length","renderDiscountForm","renderDiscountLink","render","propTypes","string","bool"],"mappings":"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","file":"/imports/plugins/core/discounts/client/components/form.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport debounce from \"lodash/debounce\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Translation } from \"/imports/plugins/core/ui/client/components\";\n\nexport default class DiscountForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      discount: this.props.discount,\n      validationMessage: null,\n      validatedInput: this.props.validatedInput || false,\n      attempts: 0,\n      discountApplied: false\n    };\n    // debounce helper so to wait on user input\n    this.debounceDiscounts = debounce(() => {\n      this.setState({ validationMessage: \"\" });\n      const { discount } = this.state;\n      // handle discount code validation messages after attempt to apply\n      Meteor.call(\"discounts/codes/apply\", this.props.id, discount, this.props.collection, (error, result) => {\n        if (typeof result === \"object\") {\n          this.setState({ validationMessage: result });\n        } else if (result !== 1) {\n            // if validationMessage isn't an object with i18n\n            // we will display an elliptical that's not\n            // actually done here though, just bit of foolery\n          this.timerId = Meteor.setTimeout(function () {\n            this.setState({ validationMessage: \"...\" });\n          }.bind(this), 2000);\n        }\n      });\n    }, 800);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentWillUnmount() {\n    if (this.timerId) Meteor.clearInterval(this.timerId);\n  }\n\n  // handle apply\n  renderApplied() {\n    return (\n      <a onClick={this.handleClick}>\n        <Translation defaultValue=\"Discount submitted.\" i18nKey=\"discounts.submitted\"/>\n      </a>\n    );\n  }\n\n  // handle keydown and change events\n  handleChange(event) {\n    const { attempts } = this.state;\n    // ensure we don't submit on enter\n    if (event.keyCode === 13) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n    // clear input if user hits escape key\n    if (event.keyCode === 27) {\n      return this.setState({ discount: \"\", validatedInput: false, attempts: 0, discountApplied: false, validationMessage: null });\n    }\n    this.setState({\n      discount: event.target.value,\n      attempts: attempts + 1\n    });\n    // TODO: this.debounce doesn't always need to exec we should add some logic to determine based on attempts or some other\n    // cleverness if now is a good time to apply the code.\n    this.debounceDiscounts();\n  }\n\n  // handle display or not\n  handleClick(event) {\n    event.preventDefault();\n    this.setState({ validatedInput: true });\n  }\n\n  // loader button\n  loader() {\n    const { attempts, discount, validationMessage } = this.state;\n    let loader;\n    if (validationMessage && validationMessage.i18nKeyLabel && attempts > 3) {\n      loader = <Translation defaultValue={validationMessage.i18nKeyLabel} i18nKey={validationMessage.i18nKey}/>;\n    } else if (validationMessage) {\n      loader = <i className=\"fa fa-ellipsis-h fa-fw\"/>;\n    } else {\n      if (discount && discount.length >= 10 && attempts >= 12) {\n        loader = <i className=\"fa fa-stop-circle fa-fw\"/>;\n      } else if (discount && discount.length >= 2 && attempts >= 2) {\n        loader = <i className=\"fa fa-circle-o-notch fa-spin fa-fw\"/>;\n      } else {\n        loader = <i className=\"fa fa-search fa-fw\"/>;\n      }\n    }\n\n    return loader;\n  }\n\n  // render discount form\n  renderDiscountForm() {\n    return (\n      <form>\n        <label htmlFor=\"discount-url\">\n          <Translation defaultValue=\"Discount Code\" i18nKey=\"discounts.discountLabel\"/>\n        </label>\n        <div className=\"input-group\">\n          <input\n            autoFocus\n            onChange={this.handleChange}\n            onKeyDown={this.handleChange}\n            className=\"form-control\"\n            id=\"discount-input\"\n            aria-describedby=\"discount-input-addon\"\n          />\n          <span className=\"input-group-addon\" id=\"discount-input-addon\">\n            {this.loader()}\n          </span>\n        </div>\n      </form>\n    );\n  }\n  // have a code link\n  renderDiscountLink() {\n    return (\n      <a onClick={this.handleClick}>\n        <Translation defaultValue=\"Have a code? Enter it here.\" i18nKey=\"discounts.enterItHere\"/>\n      </a>\n    );\n  }\n\n  // render discount code input form\n  render() {\n    const { discountApplied, validatedInput } = this.state;\n    if (discountApplied === true && validatedInput === true) {\n      return this.renderApplied();\n    } else if (validatedInput === true) {\n      return this.renderDiscountForm();\n    }\n    return this.renderDiscountLink();\n  }\n}\n\nDiscountForm.propTypes = {\n  collection: PropTypes.string,\n  discount: PropTypes.string,\n  id: PropTypes.string,\n  validatedInput: PropTypes.bool\n};\n"]},"hash":"43620d25eafa78fad9340b6dabe19a77749eaca9"}
