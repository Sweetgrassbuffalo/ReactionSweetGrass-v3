{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","extends","typeof","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"lodash/isEmpty","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"_isEmpty"}]},{"source":"radium","imported":["StyleRoot"],"specifiers":[{"kind":"named","imported":"StyleRoot","local":"StyleRoot"}]},{"source":"react","imported":["default","Component","PropTypes"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"},{"kind":"named","imported":"PropTypes","local":"PropTypes"}]},{"source":"/lib/api/compose","imported":["composeWithTracker"],"specifiers":[{"kind":"named","imported":"composeWithTracker","local":"composeWithTracker"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"/lib/api","imported":["ReactionProduct"],"specifiers":[{"kind":"named","imported":"ReactionProduct","local":"ReactionProduct"}]},{"source":"/client/api","imported":["Reaction","i18next","Logger"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"},{"kind":"named","imported":"i18next","local":"i18next"},{"kind":"named","imported":"Logger","local":"Logger"}]},{"source":"/lib/collections","imported":["Tags","Media","Cart"],"specifiers":[{"kind":"named","imported":"Tags","local":"Tags"},{"kind":"named","imported":"Media","local":"Media"},{"kind":"named","imported":"Cart","local":"Cart"}]},{"source":"/imports/plugins/core/ui/client/components","imported":["Loading"],"specifiers":[{"kind":"named","imported":"Loading","local":"Loading"}]},{"source":"../components","imported":["ProductDetail","ProductNotFound"],"specifiers":[{"kind":"named","imported":"ProductDetail","local":"ProductDetail"},{"kind":"named","imported":"ProductNotFound","local":"ProductNotFound"}]},{"source":"./","imported":["SocialContainer","VariantListContainer"],"specifiers":[{"kind":"named","imported":"SocialContainer","local":"SocialContainer"},{"kind":"named","imported":"VariantListContainer","local":"VariantListContainer"}]},{"source":"/imports/plugins/core/ui/client/containers","imported":["MediaGalleryContainer"],"specifiers":[{"kind":"named","imported":"MediaGalleryContainer","local":"MediaGalleryContainer"}]},{"source":"/imports/plugins/core/ui/client/providers","imported":["DragDropProvider","TranslationProvider"],"specifiers":[{"kind":"named","imported":"DragDropProvider","local":"DragDropProvider"},{"kind":"named","imported":"TranslationProvider","local":"TranslationProvider"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js","filenameRelative":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js"],"names":["StyleRoot","React","Component","PropTypes","composeWithTracker","Meteor","ReactionProduct","Reaction","i18next","Logger","Tags","Media","Cart","Loading","ProductDetail","ProductNotFound","SocialContainer","VariantListContainer","MediaGalleryContainer","DragDropProvider","TranslationProvider","ProductDetailContainer","constructor","props","animationTimeOut","textTimeOut","state","cartQuantity","click","handleCartQuantityChange","event","quantity","setState","Math","max","handleAddToCart","productId","maxQuantity","totalQuantity","storedQuantity","currentVariant","selectedVariant","currentProduct","selectedProduct","ancestors","length","options","getVariants","_id","Alerts","inline","placement","i18nKey","autoHide","inventoryPolicy","inventoryQuantity","storedCart","items","forEach","item","variants","parseInt","isVisible","call","error","setCurrentVariant","$","animate","scrollTop","addToCartText","t","addToCartTitle","title","alertWidth","width","direction","dir","oppositeDirection","css","addClass","text","handleSlideOut","setTimeout","handleSlideIn","clearTimeout","hide","removeClass","fadeIn","show","duration","complete","handleProductFieldChange","fieldName","value","toast","message","forceUpdate","handleViewContextChange","Router","setQueryParams","as","handleDeleteProduct","archiveProduct","product","render","media","propTypes","arrayOf","object","composer","onData","tagSub","subscribe","getParam","variantId","revisionType","getQueryParam","viewProductAs","getUserPreferences","productSub","ready","Subscriptions","setProduct","hasPermission","getActionView","isActionViewOpen","setActionView","template","data","tags","_","isArray","hashtags","map","id","findOne","mediaArray","find","sort","fetch","Array","ancestor","reverse","priceRange","childVariants","price","getVariantPriceRange","productRevision","__published","editable","topVariants","getTopVariants","layout","viewAs","hasAdminPermission"],"mappings":"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","file":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js.map","sourcesContent":["import { isEmpty } from \"lodash\";\nimport { StyleRoot } from \"radium\";\nimport React, { Component, PropTypes } from \"react\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next, Logger } from \"/client/api\";\nimport { Tags, Media, Cart } from \"/lib/collections\";\nimport { Loading } from \"/imports/plugins/core/ui/client/components\";\nimport { ProductDetail, ProductNotFound } from \"../components\";\nimport { SocialContainer, VariantListContainer } from \"./\";\nimport { MediaGalleryContainer } from \"/imports/plugins/core/ui/client/containers\";\nimport { DragDropProvider, TranslationProvider } from \"/imports/plugins/core/ui/client/providers\";\n\nclass ProductDetailContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.animationTimeOut = null;\n    this.textTimeOut = null;\n    this.state = {\n      cartQuantity: 1,\n      click: 0\n    };\n  }\n\n  handleCartQuantityChange = (event, quantity) => {\n    this.setState({\n      cartQuantity: Math.max(quantity, 1)\n    });\n  }\n\n  handleAddToCart = () => {\n    let productId;\n    let quantity;\n    let maxQuantity;\n    let totalQuantity;\n    let storedQuantity = 0;\n    const currentVariant = ReactionProduct.selectedVariant();\n    const currentProduct = ReactionProduct.selectedProduct();\n\n    if (currentVariant) {\n      if (currentVariant.ancestors.length === 1) {\n        const options = ReactionProduct.getVariants(currentVariant._id);\n\n        if (options.length > 0) {\n          Alerts.inline(\"Please choose options before adding to cart\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.chooseOptions\",\n            autoHide: 10000\n          });\n          return [];\n        }\n      }\n\n      if (currentVariant.inventoryPolicy && currentVariant.inventoryQuantity < 1) {\n        Alerts.inline(\"Sorry, this item is out of stock!\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.outOfStock\",\n          autoHide: 10000\n        });\n        return [];\n      }\n\n      if (this.props.storedCart && this.props.storedCart.items) {\n        this.props.storedCart.items.forEach((item) => {\n          if (item.variants._id === currentVariant._id) {\n            storedQuantity = item.quantity;\n          }\n        });\n      }\n\n      quantity = parseInt(this.state.cartQuantity, 10);\n      totalQuantity = quantity + storedQuantity;\n      maxQuantity = currentVariant.inventoryQuantity;\n\n      if (quantity < 1) {\n        quantity = 1;\n      }\n\n      if (currentVariant.inventoryPolicy && quantity > maxQuantity && storedQuantity < maxQuantity) {\n        Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n          autoHide: 10000\n        });\n        quantity = maxQuantity - storedQuantity;\n        totalQuantity = maxQuantity;\n      }\n\n      if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity && storedQuantity < maxQuantity && quantity < maxQuantity) {\n        Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n          autoHide: 10000\n        });\n        quantity = maxQuantity - storedQuantity;\n        totalQuantity = maxQuantity;\n      }\n\n      if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity) {\n        Alerts.inline(\"Sorry, this item is out of stock!\", \"error\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.outOfStock\",\n          autoHide: 10000\n        });\n        return [];\n      }\n\n      if (!currentProduct.isVisible) {\n        Alerts.inline(\"Publish product before adding to cart.\", \"error\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.publishFirst\",\n          autoHide: 10000\n        });\n      } else {\n        productId = currentProduct._id;\n\n        if (productId) {\n          Meteor.call(\"cart/addToCart\", productId, currentVariant._id, quantity, (error) => {\n            if (error) {\n              Logger.error(error, \"Failed to add to cart.\");\n              return error;\n            }\n            // Reset cart quantity on success\n            this.handleCartQuantityChange(null, 1);\n            this.state.click++;\n\n            return true;\n          });\n        }\n\n        // template.$(\".variant-select-option\").removeClass(\"active\");\n        ReactionProduct.setCurrentVariant(null);\n        // qtyField.val(1);\n        // scroll to top on cart add\n        $(\"html,body\").animate({\n          scrollTop: 0\n        }, 0);\n        // slide out label\n        const addToCartText = i18next.t(\"productDetail.addedToCart\");\n        const addToCartTitle = currentVariant.title || \"\";\n        // Grab and cache the width of the alert to be used in animation\n        const alertWidth = $(\".cart-alert\").width();\n        const direction = i18next.dir() === \"rtl\" ? \"left\" : \"right\";\n        const oppositeDirection = i18next.dir() === \"rtl\" ? \"right\" : \"left\";\n        if ($(\".cart-alert\").css(\"display\") === \"none\") {\n          $(\"#spin\").addClass(\"hidden\");\n          $(\".cart-alert-text\").text(`${quantity} ${addToCartTitle} ${addToCartText}`);\n          this.handleSlideOut(alertWidth, direction, oppositeDirection);\n          this.animationTimeOut = setTimeout(() => {\n            this.handleSlideIn(alertWidth, direction, oppositeDirection);\n          }, 4000);\n        } else {\n          clearTimeout(this.textTimeOut);\n\n          // hides text and display spinner\n          $(\".cart-alert-text\").hide();\n          $(\"#spin\").removeClass(\"hidden\");\n\n          this.textTimeOut = setTimeout(() => {\n            $(\"#spin\").addClass(\"hidden\");\n            $(\".cart-alert-text\").text(`${this.state.click * quantity} ${addToCartTitle} ${addToCartText}`);\n            $(\".cart-alert-text\").fadeIn(\"slow\");\n            this.setState({ click: 0 });\n          }, 2000);\n\n          clearTimeout(this.animationTimeOut);\n          this.animationTimeOut = setTimeout(() => {\n            this.handleSlideIn(alertWidth, direction, oppositeDirection);\n          }, 4000);\n        }\n      }\n    } else {\n      Alerts.inline(\"Select an option before adding to cart\", \"warning\", {\n        placement: \"productDetail\",\n        i18nKey: \"productDetail.selectOption\",\n        autoHide: 8000\n      });\n    }\n\n    return null;\n  }\n\n  handleSlideOut(alertWidth, direction, oppositeDirection) {\n    // Animate slide out\n    return $(\".cart-alert\")\n      .show()\n      .css({\n        [oppositeDirection]: \"auto\",\n        [direction]: -alertWidth\n      })\n      .animate({\n        [oppositeDirection]: \"auto\",\n        [direction]: 0\n      }, 600);\n  }\n\n  handleSlideIn(alertWidth, direction, oppositeDirection) {\n    // Animate slide in\n    return $(\".cart-alert\").animate({\n      [oppositeDirection]: \"auto\",\n      [direction]: -alertWidth\n    }, {\n      duration: 600,\n      complete() {\n        $(\".cart-alert\").hide();\n      }\n    });\n  }\n\n  handleProductFieldChange = (productId, fieldName, value) => {\n    Meteor.call(\"products/updateProductField\", productId, fieldName, value, (error) => {\n      if (error) {\n        Alerts.toast(error.message, \"error\");\n        this.forceUpdate();\n      }\n    });\n  }\n\n  handleViewContextChange = (event, value) => {\n    Reaction.Router.setQueryParams({ as: value });\n  }\n\n  handleDeleteProduct = () => {\n    ReactionProduct.archiveProduct(this.props.product);\n  }\n\n  render() {\n    if (isEmpty(this.props.product)) {\n      return (\n        <ProductNotFound />\n      );\n    }\n    return (\n      <TranslationProvider>\n        <DragDropProvider>\n          <StyleRoot>\n            <ProductDetail\n              cartQuantity={this.state.cartQuantity}\n              mediaGalleryComponent={<MediaGalleryContainer media={this.props.media} />}\n              onAddToCart={this.handleAddToCart}\n              onCartQuantityChange={this.handleCartQuantityChange}\n              onViewContextChange={this.handleViewContextChange}\n              socialComponent={<SocialContainer />}\n              topVariantComponent={<VariantListContainer />}\n              onDeleteProduct={this.handleDeleteProduct}\n              onProductFieldChange={this.handleProductFieldChange}\n              {...this.props}\n            />\n          </StyleRoot>\n        </DragDropProvider>\n      </TranslationProvider>\n    );\n  }\n}\n\nProductDetailContainer.propTypes = {\n  media: PropTypes.arrayOf(PropTypes.object),\n  product: PropTypes.object,\n  storedCart: PropTypes.object\n};\n\nfunction composer(props, onData) {\n  const tagSub = Meteor.subscribe(\"Tags\");\n  const productId = Reaction.Router.getParam(\"handle\");\n  const variantId = Reaction.Router.getParam(\"variantId\");\n  const revisionType = Reaction.Router.getQueryParam(\"revision\");\n  const viewProductAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n\n  let productSub;\n\n  if (productId) {\n    productSub = Meteor.subscribe(\"Product\", productId);\n  }\n\n  if (productSub && productSub.ready() && tagSub.ready() && Reaction.Subscriptions.Cart.ready()) {\n    // Get the product\n    const product = ReactionProduct.setProduct(productId, variantId);\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      if (!Reaction.getActionView() && Reaction.isActionViewOpen() === true) {\n        Reaction.setActionView({\n          template: \"productAdmin\",\n          data: product\n        });\n      }\n    }\n\n    // Get the product tags\n    if (product) {\n      let tags;\n      if (_.isArray(product.hashtags)) {\n        tags = _.map(product.hashtags, function (id) {\n          return Tags.findOne(id);\n        });\n      }\n\n      let mediaArray = [];\n      const selectedVariant = ReactionProduct.selectedVariant();\n\n      if (selectedVariant) {\n        // Find the media for the selected variant\n        mediaArray = Media.find({\n          \"metadata.variantId\": selectedVariant._id\n        }, {\n          sort: {\n            \"metadata.priority\": 1\n          }\n        }).fetch();\n\n        // If no media found, broaden the search to include other media from parents\n        if (Array.isArray(mediaArray) && mediaArray.length === 0 && selectedVariant.ancestors) {\n          // Loop through ancestors in reverse to find a variant that has media to use\n          for (const ancestor of selectedVariant.ancestors.reverse()) {\n            const media = Media.find({\n              \"metadata.variantId\": ancestor\n            }, {\n              sort: {\n                \"metadata.priority\": 1\n              }\n            }).fetch();\n\n            // If we found some media, then stop here\n            if (Array.isArray(media) && media.length) {\n              mediaArray = media;\n              break;\n            }\n          }\n        }\n      }\n\n      let priceRange;\n      if (selectedVariant && typeof selectedVariant === \"object\") {\n        const childVariants = ReactionProduct.getVariants(selectedVariant._id);\n        // when top variant has no child variants we display only its price\n        if (childVariants.length === 0) {\n          priceRange = selectedVariant.price;\n        } else {\n          // otherwise we want to show child variants price range\n          priceRange = ReactionProduct.getVariantPriceRange();\n        }\n      }\n\n      let productRevision;\n\n      if (revisionType === \"published\") {\n        productRevision = product.__published;\n      }\n\n      let editable;\n\n      if (viewProductAs === \"customer\") {\n        editable = false;\n      } else {\n        editable = Reaction.hasPermission([\"createProduct\"]);\n      }\n\n      const topVariants = ReactionProduct.getTopVariants();\n\n      const storedCart = Cart.findOne();\n\n      onData(null, {\n        variants: topVariants,\n        layout: product.template || \"productDetailSimple\",\n        product: productRevision || product,\n        priceRange,\n        tags,\n        media: mediaArray,\n        editable,\n        viewAs: viewProductAs,\n        hasAdminPermission: Reaction.hasPermission([\"createProduct\"]),\n        storedCart\n      });\n    } else {\n      // onData must be called with composeWithTracker, or else the loading icon will show forever.\n      onData(null, {});\n    }\n  }\n}\n\n// Decorate component and export\nexport default composeWithTracker(composer, Loading)(ProductDetailContainer);\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js.map","sourceFileName":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"productDetailContainer"},"ignored":false,"code":"var _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar _isEmpty = void 0;\n\nmodule.importSync(\"lodash/isEmpty\", {\n  \"default\": function (v) {\n    _isEmpty = v;\n  }\n}, 0);\nvar StyleRoot = void 0;\nmodule.importSync(\"radium\", {\n  StyleRoot: function (v) {\n    StyleRoot = v;\n  }\n}, 1);\nvar React = void 0,\n    Component = void 0,\n    PropTypes = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  }\n}, 2);\nvar composeWithTracker = void 0;\nmodule.importSync(\"/lib/api/compose\", {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 3);\nvar Meteor = void 0;\nmodule.importSync(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 4);\nvar ReactionProduct = void 0;\nmodule.importSync(\"/lib/api\", {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 5);\nvar Reaction = void 0,\n    i18next = void 0,\n    Logger = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  },\n  Logger: function (v) {\n    Logger = v;\n  }\n}, 6);\nvar Tags = void 0,\n    Media = void 0,\n    Cart = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Tags: function (v) {\n    Tags = v;\n  },\n  Media: function (v) {\n    Media = v;\n  },\n  Cart: function (v) {\n    Cart = v;\n  }\n}, 7);\nvar Loading = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/components\", {\n  Loading: function (v) {\n    Loading = v;\n  }\n}, 8);\nvar ProductDetail = void 0,\n    ProductNotFound = void 0;\nmodule.importSync(\"../components\", {\n  ProductDetail: function (v) {\n    ProductDetail = v;\n  },\n  ProductNotFound: function (v) {\n    ProductNotFound = v;\n  }\n}, 9);\nvar SocialContainer = void 0,\n    VariantListContainer = void 0;\nmodule.importSync(\"./\", {\n  SocialContainer: function (v) {\n    SocialContainer = v;\n  },\n  VariantListContainer: function (v) {\n    VariantListContainer = v;\n  }\n}, 10);\nvar MediaGalleryContainer = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/containers\", {\n  MediaGalleryContainer: function (v) {\n    MediaGalleryContainer = v;\n  }\n}, 11);\nvar DragDropProvider = void 0,\n    TranslationProvider = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/providers\", {\n  DragDropProvider: function (v) {\n    DragDropProvider = v;\n  },\n  TranslationProvider: function (v) {\n    TranslationProvider = v;\n  }\n}, 12);\n\nvar ProductDetailContainer = function (_Component) {\n  (0, _inherits3.default)(ProductDetailContainer, _Component);\n\n  function ProductDetailContainer(props) {\n    (0, _classCallCheck3.default)(this, ProductDetailContainer);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.handleCartQuantityChange = function (event, quantity) {\n      _this.setState({\n        cartQuantity: Math.max(quantity, 1)\n      });\n    };\n\n    _this.handleAddToCart = function () {\n      var productId = void 0;\n      var quantity = void 0;\n      var maxQuantity = void 0;\n      var totalQuantity = void 0;\n      var storedQuantity = 0;\n      var currentVariant = ReactionProduct.selectedVariant();\n      var currentProduct = ReactionProduct.selectedProduct();\n\n      if (currentVariant) {\n        if (currentVariant.ancestors.length === 1) {\n          var options = ReactionProduct.getVariants(currentVariant._id);\n\n          if (options.length > 0) {\n            Alerts.inline(\"Please choose options before adding to cart\", \"warning\", {\n              placement: \"productDetail\",\n              i18nKey: \"productDetail.chooseOptions\",\n              autoHide: 10000\n            });\n            return [];\n          }\n        }\n\n        if (currentVariant.inventoryPolicy && currentVariant.inventoryQuantity < 1) {\n          Alerts.inline(\"Sorry, this item is out of stock!\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.outOfStock\",\n            autoHide: 10000\n          });\n          return [];\n        }\n\n        if (_this.props.storedCart && _this.props.storedCart.items) {\n          _this.props.storedCart.items.forEach(function (item) {\n            if (item.variants._id === currentVariant._id) {\n              storedQuantity = item.quantity;\n            }\n          });\n        }\n\n        quantity = parseInt(_this.state.cartQuantity, 10);\n        totalQuantity = quantity + storedQuantity;\n        maxQuantity = currentVariant.inventoryQuantity;\n\n        if (quantity < 1) {\n          quantity = 1;\n        }\n\n        if (currentVariant.inventoryPolicy && quantity > maxQuantity && storedQuantity < maxQuantity) {\n          Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n            autoHide: 10000\n          });\n          quantity = maxQuantity - storedQuantity;\n          totalQuantity = maxQuantity;\n        }\n\n        if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity && storedQuantity < maxQuantity && quantity < maxQuantity) {\n          Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n            autoHide: 10000\n          });\n          quantity = maxQuantity - storedQuantity;\n          totalQuantity = maxQuantity;\n        }\n\n        if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity) {\n          Alerts.inline(\"Sorry, this item is out of stock!\", \"error\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.outOfStock\",\n            autoHide: 10000\n          });\n          return [];\n        }\n\n        if (!currentProduct.isVisible) {\n          Alerts.inline(\"Publish product before adding to cart.\", \"error\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.publishFirst\",\n            autoHide: 10000\n          });\n        } else {\n          productId = currentProduct._id;\n\n          if (productId) {\n            Meteor.call(\"cart/addToCart\", productId, currentVariant._id, quantity, function (error) {\n              if (error) {\n                Logger.error(error, \"Failed to add to cart.\");\n                return error;\n              } // Reset cart quantity on success\n\n\n              _this.handleCartQuantityChange(null, 1);\n\n              _this.state.click++;\n              return true;\n            });\n          } // template.$(\".variant-select-option\").removeClass(\"active\");\n\n\n          ReactionProduct.setCurrentVariant(null); // qtyField.val(1);\n          // scroll to top on cart add\n\n          $(\"html,body\").animate({\n            scrollTop: 0\n          }, 0); // slide out label\n\n          var addToCartText = i18next.t(\"productDetail.addedToCart\");\n          var addToCartTitle = currentVariant.title || \"\"; // Grab and cache the width of the alert to be used in animation\n\n          var alertWidth = $(\".cart-alert\").width();\n          var direction = i18next.dir() === \"rtl\" ? \"left\" : \"right\";\n          var oppositeDirection = i18next.dir() === \"rtl\" ? \"right\" : \"left\";\n\n          if ($(\".cart-alert\").css(\"display\") === \"none\") {\n            $(\"#spin\").addClass(\"hidden\");\n            $(\".cart-alert-text\").text(quantity + \" \" + addToCartTitle + \" \" + addToCartText);\n\n            _this.handleSlideOut(alertWidth, direction, oppositeDirection);\n\n            _this.animationTimeOut = setTimeout(function () {\n              _this.handleSlideIn(alertWidth, direction, oppositeDirection);\n            }, 4000);\n          } else {\n            clearTimeout(_this.textTimeOut); // hides text and display spinner\n\n            $(\".cart-alert-text\").hide();\n            $(\"#spin\").removeClass(\"hidden\");\n            _this.textTimeOut = setTimeout(function () {\n              $(\"#spin\").addClass(\"hidden\");\n              $(\".cart-alert-text\").text(_this.state.click * quantity + \" \" + addToCartTitle + \" \" + addToCartText);\n              $(\".cart-alert-text\").fadeIn(\"slow\");\n\n              _this.setState({\n                click: 0\n              });\n            }, 2000);\n            clearTimeout(_this.animationTimeOut);\n            _this.animationTimeOut = setTimeout(function () {\n              _this.handleSlideIn(alertWidth, direction, oppositeDirection);\n            }, 4000);\n          }\n        }\n      } else {\n        Alerts.inline(\"Select an option before adding to cart\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.selectOption\",\n          autoHide: 8000\n        });\n      }\n\n      return null;\n    };\n\n    _this.handleProductFieldChange = function (productId, fieldName, value) {\n      Meteor.call(\"products/updateProductField\", productId, fieldName, value, function (error) {\n        if (error) {\n          Alerts.toast(error.message, \"error\");\n\n          _this.forceUpdate();\n        }\n      });\n    };\n\n    _this.handleViewContextChange = function (event, value) {\n      Reaction.Router.setQueryParams({\n        as: value\n      });\n    };\n\n    _this.handleDeleteProduct = function () {\n      ReactionProduct.archiveProduct(_this.props.product);\n    };\n\n    _this.animationTimeOut = null;\n    _this.textTimeOut = null;\n    _this.state = {\n      cartQuantity: 1,\n      click: 0\n    };\n    return _this;\n  }\n\n  ProductDetailContainer.prototype.handleSlideOut = function () {\n    function handleSlideOut(alertWidth, direction, oppositeDirection) {\n      var _$$show$css, _$$show$css$animate;\n\n      // Animate slide out\n      return $(\".cart-alert\").show().css((_$$show$css = {}, _$$show$css[oppositeDirection] = \"auto\", _$$show$css[direction] = -alertWidth, _$$show$css)).animate((_$$show$css$animate = {}, _$$show$css$animate[oppositeDirection] = \"auto\", _$$show$css$animate[direction] = 0, _$$show$css$animate), 600);\n    }\n\n    return handleSlideOut;\n  }();\n\n  ProductDetailContainer.prototype.handleSlideIn = function () {\n    function handleSlideIn(alertWidth, direction, oppositeDirection) {\n      var _$$animate;\n\n      // Animate slide in\n      return $(\".cart-alert\").animate((_$$animate = {}, _$$animate[oppositeDirection] = \"auto\", _$$animate[direction] = -alertWidth, _$$animate), {\n        duration: 600,\n        complete: function () {\n          $(\".cart-alert\").hide();\n        }\n      });\n    }\n\n    return handleSlideIn;\n  }();\n\n  ProductDetailContainer.prototype.render = function () {\n    function render() {\n      if (_isEmpty(this.props.product)) {\n        return React.createElement(ProductNotFound, null);\n      }\n\n      return React.createElement(\n        TranslationProvider,\n        null,\n        React.createElement(\n          DragDropProvider,\n          null,\n          React.createElement(\n            StyleRoot,\n            null,\n            React.createElement(ProductDetail, (0, _extends3.default)({\n              cartQuantity: this.state.cartQuantity,\n              mediaGalleryComponent: React.createElement(MediaGalleryContainer, {\n                media: this.props.media\n              }),\n              onAddToCart: this.handleAddToCart,\n              onCartQuantityChange: this.handleCartQuantityChange,\n              onViewContextChange: this.handleViewContextChange,\n              socialComponent: React.createElement(SocialContainer, null),\n              topVariantComponent: React.createElement(VariantListContainer, null),\n              onDeleteProduct: this.handleDeleteProduct,\n              onProductFieldChange: this.handleProductFieldChange\n            }, this.props))\n          )\n        )\n      );\n    }\n\n    return render;\n  }();\n\n  return ProductDetailContainer;\n}(Component);\n\nProductDetailContainer.propTypes = {\n  media: PropTypes.arrayOf(PropTypes.object),\n  product: PropTypes.object,\n  storedCart: PropTypes.object\n};\n\nfunction composer(props, onData) {\n  var tagSub = Meteor.subscribe(\"Tags\");\n  var productId = Reaction.Router.getParam(\"handle\");\n  var variantId = Reaction.Router.getParam(\"variantId\");\n  var revisionType = Reaction.Router.getQueryParam(\"revision\");\n  var viewProductAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n  var productSub = void 0;\n\n  if (productId) {\n    productSub = Meteor.subscribe(\"Product\", productId);\n  }\n\n  if (productSub && productSub.ready() && tagSub.ready() && Reaction.Subscriptions.Cart.ready()) {\n    // Get the product\n    var product = ReactionProduct.setProduct(productId, variantId);\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      if (!Reaction.getActionView() && Reaction.isActionViewOpen() === true) {\n        Reaction.setActionView({\n          template: \"productAdmin\",\n          data: product\n        });\n      }\n    } // Get the product tags\n\n\n    if (product) {\n      var tags = void 0;\n\n      if (_.isArray(product.hashtags)) {\n        tags = _.map(product.hashtags, function (id) {\n          return Tags.findOne(id);\n        });\n      }\n\n      var mediaArray = [];\n      var selectedVariant = ReactionProduct.selectedVariant();\n\n      if (selectedVariant) {\n        // Find the media for the selected variant\n        mediaArray = Media.find({\n          \"metadata.variantId\": selectedVariant._id\n        }, {\n          sort: {\n            \"metadata.priority\": 1\n          }\n        }).fetch(); // If no media found, broaden the search to include other media from parents\n\n        if (Array.isArray(mediaArray) && mediaArray.length === 0 && selectedVariant.ancestors) {\n          // Loop through ancestors in reverse to find a variant that has media to use\n          for (var _iterator = selectedVariant.ancestors.reverse(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n            var _ref;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref = _i.value;\n            }\n\n            var ancestor = _ref;\n            var media = Media.find({\n              \"metadata.variantId\": ancestor\n            }, {\n              sort: {\n                \"metadata.priority\": 1\n              }\n            }).fetch(); // If we found some media, then stop here\n\n            if (Array.isArray(media) && media.length) {\n              mediaArray = media;\n              break;\n            }\n          }\n        }\n      }\n\n      var priceRange = void 0;\n\n      if (selectedVariant && (typeof selectedVariant === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(selectedVariant)) === \"object\") {\n        var childVariants = ReactionProduct.getVariants(selectedVariant._id); // when top variant has no child variants we display only its price\n\n        if (childVariants.length === 0) {\n          priceRange = selectedVariant.price;\n        } else {\n          // otherwise we want to show child variants price range\n          priceRange = ReactionProduct.getVariantPriceRange();\n        }\n      }\n\n      var productRevision = void 0;\n\n      if (revisionType === \"published\") {\n        productRevision = product.__published;\n      }\n\n      var editable = void 0;\n\n      if (viewProductAs === \"customer\") {\n        editable = false;\n      } else {\n        editable = Reaction.hasPermission([\"createProduct\"]);\n      }\n\n      var topVariants = ReactionProduct.getTopVariants();\n      var storedCart = Cart.findOne();\n      onData(null, {\n        variants: topVariants,\n        layout: product.template || \"productDetailSimple\",\n        product: productRevision || product,\n        priceRange: priceRange,\n        tags: tags,\n        media: mediaArray,\n        editable: editable,\n        viewAs: viewProductAs,\n        hasAdminPermission: Reaction.hasPermission([\"createProduct\"]),\n        storedCart: storedCart\n      });\n    } else {\n      // onData must be called with composeWithTracker, or else the loading icon will show forever.\n      onData(null, {});\n    }\n  }\n} // Decorate component and export\n\n\nmodule.export(\"default\", exports.default = composeWithTracker(composer, Loading)(ProductDetailContainer));","map":{"version":3,"sources":["/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js"],"names":["StyleRoot","React","Component","PropTypes","composeWithTracker","Meteor","ReactionProduct","Reaction","i18next","Logger","Tags","Media","Cart","Loading","ProductDetail","ProductNotFound","SocialContainer","VariantListContainer","MediaGalleryContainer","DragDropProvider","TranslationProvider","ProductDetailContainer","constructor","props","animationTimeOut","textTimeOut","state","cartQuantity","click","handleCartQuantityChange","event","quantity","setState","Math","max","handleAddToCart","productId","maxQuantity","totalQuantity","storedQuantity","currentVariant","selectedVariant","currentProduct","selectedProduct","ancestors","length","options","getVariants","_id","Alerts","inline","placement","i18nKey","autoHide","inventoryPolicy","inventoryQuantity","storedCart","items","forEach","item","variants","parseInt","isVisible","call","error","setCurrentVariant","$","animate","scrollTop","addToCartText","t","addToCartTitle","title","alertWidth","width","direction","dir","oppositeDirection","css","addClass","text","handleSlideOut","setTimeout","handleSlideIn","clearTimeout","hide","removeClass","fadeIn","show","duration","complete","handleProductFieldChange","fieldName","value","toast","message","forceUpdate","handleViewContextChange","Router","setQueryParams","as","handleDeleteProduct","archiveProduct","product","render","media","propTypes","arrayOf","object","composer","onData","tagSub","subscribe","getParam","variantId","revisionType","getQueryParam","viewProductAs","getUserPreferences","productSub","ready","Subscriptions","setProduct","hasPermission","getActionView","isActionViewOpen","setActionView","template","data","tags","_","isArray","hashtags","map","id","findOne","mediaArray","find","sort","fetch","Array","ancestor","reverse","priceRange","childVariants","price","getVariantPriceRange","productRevision","__published","editable","topVariants","getTopVariants","layout","viewAs","hasAdminPermission"],"mappings":"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","file":"/imports/plugins/included/product-detail-simple/client/containers/productDetailContainer.js.map","sourcesContent":["import { isEmpty } from \"lodash\";\nimport { StyleRoot } from \"radium\";\nimport React, { Component, PropTypes } from \"react\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { Meteor } from \"meteor/meteor\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next, Logger } from \"/client/api\";\nimport { Tags, Media, Cart } from \"/lib/collections\";\nimport { Loading } from \"/imports/plugins/core/ui/client/components\";\nimport { ProductDetail, ProductNotFound } from \"../components\";\nimport { SocialContainer, VariantListContainer } from \"./\";\nimport { MediaGalleryContainer } from \"/imports/plugins/core/ui/client/containers\";\nimport { DragDropProvider, TranslationProvider } from \"/imports/plugins/core/ui/client/providers\";\n\nclass ProductDetailContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.animationTimeOut = null;\n    this.textTimeOut = null;\n    this.state = {\n      cartQuantity: 1,\n      click: 0\n    };\n  }\n\n  handleCartQuantityChange = (event, quantity) => {\n    this.setState({\n      cartQuantity: Math.max(quantity, 1)\n    });\n  }\n\n  handleAddToCart = () => {\n    let productId;\n    let quantity;\n    let maxQuantity;\n    let totalQuantity;\n    let storedQuantity = 0;\n    const currentVariant = ReactionProduct.selectedVariant();\n    const currentProduct = ReactionProduct.selectedProduct();\n\n    if (currentVariant) {\n      if (currentVariant.ancestors.length === 1) {\n        const options = ReactionProduct.getVariants(currentVariant._id);\n\n        if (options.length > 0) {\n          Alerts.inline(\"Please choose options before adding to cart\", \"warning\", {\n            placement: \"productDetail\",\n            i18nKey: \"productDetail.chooseOptions\",\n            autoHide: 10000\n          });\n          return [];\n        }\n      }\n\n      if (currentVariant.inventoryPolicy && currentVariant.inventoryQuantity < 1) {\n        Alerts.inline(\"Sorry, this item is out of stock!\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.outOfStock\",\n          autoHide: 10000\n        });\n        return [];\n      }\n\n      if (this.props.storedCart && this.props.storedCart.items) {\n        this.props.storedCart.items.forEach((item) => {\n          if (item.variants._id === currentVariant._id) {\n            storedQuantity = item.quantity;\n          }\n        });\n      }\n\n      quantity = parseInt(this.state.cartQuantity, 10);\n      totalQuantity = quantity + storedQuantity;\n      maxQuantity = currentVariant.inventoryQuantity;\n\n      if (quantity < 1) {\n        quantity = 1;\n      }\n\n      if (currentVariant.inventoryPolicy && quantity > maxQuantity && storedQuantity < maxQuantity) {\n        Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n          autoHide: 10000\n        });\n        quantity = maxQuantity - storedQuantity;\n        totalQuantity = maxQuantity;\n      }\n\n      if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity && storedQuantity < maxQuantity && quantity < maxQuantity) {\n        Alerts.inline(\"Your product quantity has been adjusted to the max quantity in stock\", \"warning\", {\n          placement: \"productDetail\",\n          i18nKey: \"admin.inventoryAlerts.adjustedQuantity\",\n          autoHide: 10000\n        });\n        quantity = maxQuantity - storedQuantity;\n        totalQuantity = maxQuantity;\n      }\n\n      if (currentVariant.inventoryPolicy && totalQuantity > maxQuantity) {\n        Alerts.inline(\"Sorry, this item is out of stock!\", \"error\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.outOfStock\",\n          autoHide: 10000\n        });\n        return [];\n      }\n\n      if (!currentProduct.isVisible) {\n        Alerts.inline(\"Publish product before adding to cart.\", \"error\", {\n          placement: \"productDetail\",\n          i18nKey: \"productDetail.publishFirst\",\n          autoHide: 10000\n        });\n      } else {\n        productId = currentProduct._id;\n\n        if (productId) {\n          Meteor.call(\"cart/addToCart\", productId, currentVariant._id, quantity, (error) => {\n            if (error) {\n              Logger.error(error, \"Failed to add to cart.\");\n              return error;\n            }\n            // Reset cart quantity on success\n            this.handleCartQuantityChange(null, 1);\n            this.state.click++;\n\n            return true;\n          });\n        }\n\n        // template.$(\".variant-select-option\").removeClass(\"active\");\n        ReactionProduct.setCurrentVariant(null);\n        // qtyField.val(1);\n        // scroll to top on cart add\n        $(\"html,body\").animate({\n          scrollTop: 0\n        }, 0);\n        // slide out label\n        const addToCartText = i18next.t(\"productDetail.addedToCart\");\n        const addToCartTitle = currentVariant.title || \"\";\n        // Grab and cache the width of the alert to be used in animation\n        const alertWidth = $(\".cart-alert\").width();\n        const direction = i18next.dir() === \"rtl\" ? \"left\" : \"right\";\n        const oppositeDirection = i18next.dir() === \"rtl\" ? \"right\" : \"left\";\n        if ($(\".cart-alert\").css(\"display\") === \"none\") {\n          $(\"#spin\").addClass(\"hidden\");\n          $(\".cart-alert-text\").text(`${quantity} ${addToCartTitle} ${addToCartText}`);\n          this.handleSlideOut(alertWidth, direction, oppositeDirection);\n          this.animationTimeOut = setTimeout(() => {\n            this.handleSlideIn(alertWidth, direction, oppositeDirection);\n          }, 4000);\n        } else {\n          clearTimeout(this.textTimeOut);\n\n          // hides text and display spinner\n          $(\".cart-alert-text\").hide();\n          $(\"#spin\").removeClass(\"hidden\");\n\n          this.textTimeOut = setTimeout(() => {\n            $(\"#spin\").addClass(\"hidden\");\n            $(\".cart-alert-text\").text(`${this.state.click * quantity} ${addToCartTitle} ${addToCartText}`);\n            $(\".cart-alert-text\").fadeIn(\"slow\");\n            this.setState({ click: 0 });\n          }, 2000);\n\n          clearTimeout(this.animationTimeOut);\n          this.animationTimeOut = setTimeout(() => {\n            this.handleSlideIn(alertWidth, direction, oppositeDirection);\n          }, 4000);\n        }\n      }\n    } else {\n      Alerts.inline(\"Select an option before adding to cart\", \"warning\", {\n        placement: \"productDetail\",\n        i18nKey: \"productDetail.selectOption\",\n        autoHide: 8000\n      });\n    }\n\n    return null;\n  }\n\n  handleSlideOut(alertWidth, direction, oppositeDirection) {\n    // Animate slide out\n    return $(\".cart-alert\")\n      .show()\n      .css({\n        [oppositeDirection]: \"auto\",\n        [direction]: -alertWidth\n      })\n      .animate({\n        [oppositeDirection]: \"auto\",\n        [direction]: 0\n      }, 600);\n  }\n\n  handleSlideIn(alertWidth, direction, oppositeDirection) {\n    // Animate slide in\n    return $(\".cart-alert\").animate({\n      [oppositeDirection]: \"auto\",\n      [direction]: -alertWidth\n    }, {\n      duration: 600,\n      complete() {\n        $(\".cart-alert\").hide();\n      }\n    });\n  }\n\n  handleProductFieldChange = (productId, fieldName, value) => {\n    Meteor.call(\"products/updateProductField\", productId, fieldName, value, (error) => {\n      if (error) {\n        Alerts.toast(error.message, \"error\");\n        this.forceUpdate();\n      }\n    });\n  }\n\n  handleViewContextChange = (event, value) => {\n    Reaction.Router.setQueryParams({ as: value });\n  }\n\n  handleDeleteProduct = () => {\n    ReactionProduct.archiveProduct(this.props.product);\n  }\n\n  render() {\n    if (isEmpty(this.props.product)) {\n      return (\n        <ProductNotFound />\n      );\n    }\n    return (\n      <TranslationProvider>\n        <DragDropProvider>\n          <StyleRoot>\n            <ProductDetail\n              cartQuantity={this.state.cartQuantity}\n              mediaGalleryComponent={<MediaGalleryContainer media={this.props.media} />}\n              onAddToCart={this.handleAddToCart}\n              onCartQuantityChange={this.handleCartQuantityChange}\n              onViewContextChange={this.handleViewContextChange}\n              socialComponent={<SocialContainer />}\n              topVariantComponent={<VariantListContainer />}\n              onDeleteProduct={this.handleDeleteProduct}\n              onProductFieldChange={this.handleProductFieldChange}\n              {...this.props}\n            />\n          </StyleRoot>\n        </DragDropProvider>\n      </TranslationProvider>\n    );\n  }\n}\n\nProductDetailContainer.propTypes = {\n  media: PropTypes.arrayOf(PropTypes.object),\n  product: PropTypes.object,\n  storedCart: PropTypes.object\n};\n\nfunction composer(props, onData) {\n  const tagSub = Meteor.subscribe(\"Tags\");\n  const productId = Reaction.Router.getParam(\"handle\");\n  const variantId = Reaction.Router.getParam(\"variantId\");\n  const revisionType = Reaction.Router.getQueryParam(\"revision\");\n  const viewProductAs = Reaction.getUserPreferences(\"reaction-dashboard\", \"viewAs\", \"administrator\");\n\n  let productSub;\n\n  if (productId) {\n    productSub = Meteor.subscribe(\"Product\", productId);\n  }\n\n  if (productSub && productSub.ready() && tagSub.ready() && Reaction.Subscriptions.Cart.ready()) {\n    // Get the product\n    const product = ReactionProduct.setProduct(productId, variantId);\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      if (!Reaction.getActionView() && Reaction.isActionViewOpen() === true) {\n        Reaction.setActionView({\n          template: \"productAdmin\",\n          data: product\n        });\n      }\n    }\n\n    // Get the product tags\n    if (product) {\n      let tags;\n      if (_.isArray(product.hashtags)) {\n        tags = _.map(product.hashtags, function (id) {\n          return Tags.findOne(id);\n        });\n      }\n\n      let mediaArray = [];\n      const selectedVariant = ReactionProduct.selectedVariant();\n\n      if (selectedVariant) {\n        // Find the media for the selected variant\n        mediaArray = Media.find({\n          \"metadata.variantId\": selectedVariant._id\n        }, {\n          sort: {\n            \"metadata.priority\": 1\n          }\n        }).fetch();\n\n        // If no media found, broaden the search to include other media from parents\n        if (Array.isArray(mediaArray) && mediaArray.length === 0 && selectedVariant.ancestors) {\n          // Loop through ancestors in reverse to find a variant that has media to use\n          for (const ancestor of selectedVariant.ancestors.reverse()) {\n            const media = Media.find({\n              \"metadata.variantId\": ancestor\n            }, {\n              sort: {\n                \"metadata.priority\": 1\n              }\n            }).fetch();\n\n            // If we found some media, then stop here\n            if (Array.isArray(media) && media.length) {\n              mediaArray = media;\n              break;\n            }\n          }\n        }\n      }\n\n      let priceRange;\n      if (selectedVariant && typeof selectedVariant === \"object\") {\n        const childVariants = ReactionProduct.getVariants(selectedVariant._id);\n        // when top variant has no child variants we display only its price\n        if (childVariants.length === 0) {\n          priceRange = selectedVariant.price;\n        } else {\n          // otherwise we want to show child variants price range\n          priceRange = ReactionProduct.getVariantPriceRange();\n        }\n      }\n\n      let productRevision;\n\n      if (revisionType === \"published\") {\n        productRevision = product.__published;\n      }\n\n      let editable;\n\n      if (viewProductAs === \"customer\") {\n        editable = false;\n      } else {\n        editable = Reaction.hasPermission([\"createProduct\"]);\n      }\n\n      const topVariants = ReactionProduct.getTopVariants();\n\n      const storedCart = Cart.findOne();\n\n      onData(null, {\n        variants: topVariants,\n        layout: product.template || \"productDetailSimple\",\n        product: productRevision || product,\n        priceRange,\n        tags,\n        media: mediaArray,\n        editable,\n        viewAs: viewProductAs,\n        hasAdminPermission: Reaction.hasPermission([\"createProduct\"]),\n        storedCart\n      });\n    } else {\n      // onData must be called with composeWithTracker, or else the loading icon will show forever.\n      onData(null, {});\n    }\n  }\n}\n\n// Decorate component and export\nexport default composeWithTracker(composer, Loading)(ProductDetailContainer);\n"]},"hash":"c5c2be3e54c329225dc5aa717c6ba381858289ac"}
