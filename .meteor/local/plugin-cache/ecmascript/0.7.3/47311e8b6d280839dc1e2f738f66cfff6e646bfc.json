{"metadata":{"usedHelpers":["typeof","inherits","possibleConstructorReturn","createClass","classCallCheck","extends","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component","PropTypes"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"},{"kind":"named","imported":"PropTypes","local":"PropTypes"}]},{"source":"/lib/api/compose","imported":["composeWithTracker"],"specifiers":[{"kind":"named","imported":"composeWithTracker","local":"composeWithTracker"}]},{"source":"/lib/api","imported":["ReactionProduct"],"specifiers":[{"kind":"named","imported":"ReactionProduct","local":"ReactionProduct"}]},{"source":"/client/api","imported":["Reaction","i18next"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"},{"kind":"named","imported":"i18next","local":"i18next"}]},{"source":"../components","imported":["VariantList"],"specifiers":[{"kind":"named","imported":"VariantList","local":"VariantList"}]},{"source":"../selectors/variants","imported":["getChildVariants"],"specifiers":[{"kind":"named","imported":"getChildVariants","local":"getChildVariants"}]},{"source":"/lib/collections","imported":["Products","Media"],"specifiers":[{"kind":"named","imported":"Products","local":"Products"},{"kind":"named","imported":"Media","local":"Media"}]},{"source":"react/lib/update","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"update"}]},{"source":"/lib/selectors/variants","imported":["getVariantIds"],"specifiers":[{"kind":"named","imported":"getVariantIds","local":"getVariantIds"}]},{"source":"/imports/plugins/core/ui/client/providers","imported":["DragDropProvider"],"specifiers":[{"kind":"named","imported":"DragDropProvider","local":"DragDropProvider"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js","filenameRelative":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js"],"names":["React","Component","PropTypes","composeWithTracker","ReactionProduct","Reaction","i18next","VariantList","getChildVariants","Products","Media","update","getVariantIds","DragDropProvider","variantIsSelected","variantId","current","selectedVariant","_id","ancestors","indexOf","variantIsInActionView","actionViewVariant","getActionView","data","isActionViewOpen","getTopVariants","inventoryTotal","variants","length","variant","inventoryManagement","qty","getVariantQuantity","inventoryPercentage","parseInt","title","inventoryWidth","sort","a","b","index","isSoldOut","VariantListContainer","componentWillReceiveProps","setState","state","props","productHandle","selectedProduct","__published","handle","handleCreateVariant","Meteor","call","error","Alerts","alert","text","t","confirmButtonText","defaultValue","handleVariantClick","event","handleEditVariant","setCurrentVariant","Session","set","Router","go","as","getQueryParam","editVariant","findOne","hasPermission","showActionView","label","i18nKeyLabel","template","handleVariantVisibilityToggle","variantIsVisible","handleMoveVariant","dragIndex","hoverIndex","newVariantOrder","$splice","defer","render","composer","onData","childVariantMedia","childVariants","Array","isArray","find","$in","fetch","editable","isPreview","displayPrice","getVariantPriceRange","propTypes","arrayOf","object"],"mappings":"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","file":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { VariantList } from \"../components\";\nimport { getChildVariants } from \"../selectors/variants\";\nimport { Products, Media } from \"/lib/collections\";\nimport update from \"react/lib/update\";\nimport { getVariantIds } from \"/lib/selectors/variants\";\nimport { DragDropProvider } from \"/imports/plugins/core/ui/client/providers\";\n\nfunction variantIsSelected(variantId) {\n  const current = ReactionProduct.selectedVariant();\n  if (current && typeof current === \"object\" && (variantId === current._id || ~current.ancestors.indexOf(variantId))) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction variantIsInActionView(variantId) {\n  const actionViewVariant = Reaction.getActionView().data;\n\n  if (actionViewVariant) {\n    // Check if the variant is selected, and also visible & selected in the action view\n    return variantIsSelected(variantId) && variantIsSelected(actionViewVariant._id) && Reaction.isActionViewOpen();\n  }\n\n  return false;\n}\n\nfunction getTopVariants() {\n  let inventoryTotal = 0;\n  const variants = ReactionProduct.getTopVariants();\n  if (variants.length) {\n    // calculate inventory total for all variants\n    for (const variant of variants) {\n      if (variant.inventoryManagement) {\n        const qty = ReactionProduct.getVariantQuantity(variant);\n        if (typeof qty === \"number\") {\n          inventoryTotal += qty;\n        }\n      }\n    }\n    // calculate percentage of total inventory of this product\n    for (const variant of variants) {\n      const qty = ReactionProduct.getVariantQuantity(variant);\n      variant.inventoryTotal = inventoryTotal;\n      if (variant.inventoryManagement && inventoryTotal) {\n        variant.inventoryPercentage = parseInt(qty / inventoryTotal * 100, 10);\n      } else {\n        // for cases when sellers doesn't use inventory we should always show\n        // \"green\" progress bar\n        variant.inventoryPercentage = 100;\n      }\n      if (variant.title) {\n        variant.inventoryWidth = parseInt(variant.inventoryPercentage -\n          variant.title.length, 10);\n      } else {\n        variant.inventoryWidth = 0;\n      }\n    }\n    // sort variants in correct order\n    variants.sort((a, b) => a.index - b.index);\n\n    return variants;\n  }\n  return [];\n}\n\nfunction isSoldOut(variant) {\n  return ReactionProduct.getVariantQuantity(variant) < 1;\n}\n\nclass VariantListContainer extends Component {\n  componentWillReceiveProps() {\n    this.setState({});\n  }\n\n  get variants() {\n    return (this.state && this.state.variants) || this.props.variants;\n  }\n\n  get productHandle() {\n    const selectedProduct = ReactionProduct.selectedProduct();\n    return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n  }\n\n  handleCreateVariant = () => {\n    const selectedProduct =  ReactionProduct.selectedProduct();\n\n    Meteor.call(\"products/createVariant\", selectedProduct._id, (error) => {\n      if (error) {\n        Alerts.alert({\n          text: i18next.t(\"productDetailEdit.addVariantFail\", { title: selectedProduct.title }),\n          confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n        });\n      }\n    });\n  }\n\n  handleVariantClick = (event, variant, ancestors = -1) => {\n    if (Reaction.isActionViewOpen()) {\n      this.handleEditVariant(event, variant, ancestors);\n    } else {\n      ReactionProduct.setCurrentVariant(variant._id);\n      Session.set(\"variant-form-\" + variant._id, true);\n      Reaction.Router.go(\"product\", {\n        handle: this.productHandle,\n        variantId: variant._id\n      }, {\n        as: Reaction.Router.getQueryParam(\"as\")\n      });\n    }\n  }\n\n  handleEditVariant = (event, variant, ancestors = -1) => {\n    let editVariant = variant;\n    if (ancestors >= 0) {\n      editVariant = Products.findOne(variant.ancestors[ancestors]);\n    }\n\n    ReactionProduct.setCurrentVariant(variant._id);\n    Session.set(\"variant-form-\" + editVariant._id, true);\n    Reaction.Router.go(\"product\", {\n      handle: this.productHandle,\n      variantId: variant._id\n    }, {\n      as: Reaction.Router.getQueryParam(\"as\")\n    });\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      Reaction.showActionView({\n        label: \"Edit Variant\",\n        i18nKeyLabel: \"productDetailEdit.editVariant\",\n        template: \"variantForm\",\n        data: editVariant\n      });\n    }\n\n    // Prevent the default edit button `onEditButtonClick` function from running\n    return false;\n  }\n\n  handleVariantVisibilityToggle = (event, variant, variantIsVisible) => {\n    Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", variantIsVisible);\n  }\n\n  handleMoveVariant = (dragIndex, hoverIndex) => {\n    const variant = this.props.variants[dragIndex];\n\n    // Apply new sort order to variant list\n    const newVariantOrder = update(this.props.variants, {\n      $splice: [\n        [dragIndex, 1],\n        [hoverIndex, 0, variant]\n      ]\n    });\n\n    // Set local state so the component does't have to wait for a round-trip\n    // to the server to get the updated list of variants\n    this.setState({\n      variants: newVariantOrder\n    });\n\n    // Save the updated positions\n    Meteor.defer(() => {\n      Meteor.call(\"products/updateVariantsPosition\", getVariantIds(newVariantOrder));\n    });\n  }\n\n  render() {\n    return (\n      <DragDropProvider>\n        <VariantList\n          onEditVariant={this.handleEditVariant}\n          onMoveVariant={this.handleMoveVariant}\n          onVariantClick={this.handleVariantClick}\n          onVariantVisibiltyToggle={this.handleVariantVisibilityToggle}\n          onCreateVariant={this.handleCreateVariant}\n          {...this.props}\n          variants={this.variants}\n        />\n      </DragDropProvider>\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  let childVariantMedia = [];\n  const childVariants = getChildVariants();\n\n  if (Array.isArray(childVariants)) {\n    childVariantMedia = Media.find({\n      \"metadata.variantId\": {\n        $in: getVariantIds(childVariants)\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    }).fetch();\n  }\n\n  let editable;\n\n  if (Reaction.isPreview() === true) {\n    editable = false;\n  } else {\n    editable = Reaction.hasPermission([\"createProduct\"]);\n  }\n\n  onData(null, {\n    variants: getTopVariants(),\n    variantIsSelected,\n    variantIsInActionView,\n    childVariants,\n    childVariantMedia,\n    displayPrice: ReactionProduct.getVariantPriceRange,\n    isSoldOut: isSoldOut,\n    editable\n  });\n}\n\nVariantListContainer.propTypes = {\n  variants: PropTypes.arrayOf(PropTypes.object)\n};\n\nexport default composeWithTracker(composer)(VariantListContainer);\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js.map","sourceFileName":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"variantListContainer"},"ignored":false,"code":"var _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require(\"babel-runtime/helpers/createClass\");\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _typeof2 = require(\"babel-runtime/helpers/typeof\");\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    Component = void 0,\n    PropTypes = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  }\n}, 0);\nvar composeWithTracker = void 0;\nmodule.importSync(\"/lib/api/compose\", {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 1);\nvar ReactionProduct = void 0;\nmodule.importSync(\"/lib/api\", {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 2);\nvar Reaction = void 0,\n    i18next = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 3);\nvar VariantList = void 0;\nmodule.importSync(\"../components\", {\n  VariantList: function (v) {\n    VariantList = v;\n  }\n}, 4);\nvar getChildVariants = void 0;\nmodule.importSync(\"../selectors/variants\", {\n  getChildVariants: function (v) {\n    getChildVariants = v;\n  }\n}, 5);\nvar Products = void 0,\n    Media = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Products: function (v) {\n    Products = v;\n  },\n  Media: function (v) {\n    Media = v;\n  }\n}, 6);\nvar update = void 0;\nmodule.importSync(\"react/lib/update\", {\n  \"default\": function (v) {\n    update = v;\n  }\n}, 7);\nvar getVariantIds = void 0;\nmodule.importSync(\"/lib/selectors/variants\", {\n  getVariantIds: function (v) {\n    getVariantIds = v;\n  }\n}, 8);\nvar DragDropProvider = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/providers\", {\n  DragDropProvider: function (v) {\n    DragDropProvider = v;\n  }\n}, 9);\n\nfunction variantIsSelected(variantId) {\n  var current = ReactionProduct.selectedVariant();\n\n  if (current && (typeof current === \"undefined\" ? \"undefined\" : (0, _typeof3.default)(current)) === \"object\" && (variantId === current._id || ~current.ancestors.indexOf(variantId))) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction variantIsInActionView(variantId) {\n  var actionViewVariant = Reaction.getActionView().data;\n\n  if (actionViewVariant) {\n    // Check if the variant is selected, and also visible & selected in the action view\n    return variantIsSelected(variantId) && variantIsSelected(actionViewVariant._id) && Reaction.isActionViewOpen();\n  }\n\n  return false;\n}\n\nfunction getTopVariants() {\n  var inventoryTotal = 0;\n  var variants = ReactionProduct.getTopVariants();\n\n  if (variants.length) {\n    // calculate inventory total for all variants\n    for (var _iterator = variants, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var variant = _ref;\n\n      if (variant.inventoryManagement) {\n        var qty = ReactionProduct.getVariantQuantity(variant);\n\n        if (typeof qty === \"number\") {\n          inventoryTotal += qty;\n        }\n      }\n    } // calculate percentage of total inventory of this product\n\n\n    for (var _iterator2 = variants, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var _variant = _ref2;\n      var qty = ReactionProduct.getVariantQuantity(_variant);\n      _variant.inventoryTotal = inventoryTotal;\n\n      if (_variant.inventoryManagement && inventoryTotal) {\n        _variant.inventoryPercentage = parseInt(qty / inventoryTotal * 100, 10);\n      } else {\n        // for cases when sellers doesn't use inventory we should always show\n        // \"green\" progress bar\n        _variant.inventoryPercentage = 100;\n      }\n\n      if (_variant.title) {\n        _variant.inventoryWidth = parseInt(_variant.inventoryPercentage - _variant.title.length, 10);\n      } else {\n        _variant.inventoryWidth = 0;\n      }\n    } // sort variants in correct order\n\n\n    variants.sort(function (a, b) {\n      return a.index - b.index;\n    });\n    return variants;\n  }\n\n  return [];\n}\n\nfunction isSoldOut(variant) {\n  return ReactionProduct.getVariantQuantity(variant) < 1;\n}\n\nvar VariantListContainer = function (_Component) {\n  (0, _inherits3.default)(VariantListContainer, _Component);\n\n  function VariantListContainer() {\n    var _temp, _this, _ret;\n\n    (0, _classCallCheck3.default)(this, VariantListContainer);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, _Component.call.apply(_Component, [this].concat(args))), _this), _this.handleCreateVariant = function () {\n      var selectedProduct = ReactionProduct.selectedProduct();\n      Meteor.call(\"products/createVariant\", selectedProduct._id, function (error) {\n        if (error) {\n          Alerts.alert({\n            text: i18next.t(\"productDetailEdit.addVariantFail\", {\n              title: selectedProduct.title\n            }),\n            confirmButtonText: i18next.t(\"app.close\", {\n              defaultValue: \"Close\"\n            })\n          });\n        }\n      });\n    }, _this.handleVariantClick = function (event, variant) {\n      var ancestors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n\n      if (Reaction.isActionViewOpen()) {\n        _this.handleEditVariant(event, variant, ancestors);\n      } else {\n        ReactionProduct.setCurrentVariant(variant._id);\n        Session.set(\"variant-form-\" + variant._id, true);\n        Reaction.Router.go(\"product\", {\n          handle: _this.productHandle,\n          variantId: variant._id\n        }, {\n          as: Reaction.Router.getQueryParam(\"as\")\n        });\n      }\n    }, _this.handleEditVariant = function (event, variant) {\n      var ancestors = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n      var editVariant = variant;\n\n      if (ancestors >= 0) {\n        editVariant = Products.findOne(variant.ancestors[ancestors]);\n      }\n\n      ReactionProduct.setCurrentVariant(variant._id);\n      Session.set(\"variant-form-\" + editVariant._id, true);\n      Reaction.Router.go(\"product\", {\n        handle: _this.productHandle,\n        variantId: variant._id\n      }, {\n        as: Reaction.Router.getQueryParam(\"as\")\n      });\n\n      if (Reaction.hasPermission(\"createProduct\")) {\n        Reaction.showActionView({\n          label: \"Edit Variant\",\n          i18nKeyLabel: \"productDetailEdit.editVariant\",\n          template: \"variantForm\",\n          data: editVariant\n        });\n      } // Prevent the default edit button `onEditButtonClick` function from running\n\n\n      return false;\n    }, _this.handleVariantVisibilityToggle = function (event, variant, variantIsVisible) {\n      Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", variantIsVisible);\n    }, _this.handleMoveVariant = function (dragIndex, hoverIndex) {\n      var variant = _this.props.variants[dragIndex]; // Apply new sort order to variant list\n\n      var newVariantOrder = update(_this.props.variants, {\n        $splice: [[dragIndex, 1], [hoverIndex, 0, variant]]\n      }); // Set local state so the component does't have to wait for a round-trip\n      // to the server to get the updated list of variants\n\n      _this.setState({\n        variants: newVariantOrder\n      }); // Save the updated positions\n\n\n      Meteor.defer(function () {\n        Meteor.call(\"products/updateVariantsPosition\", getVariantIds(newVariantOrder));\n      });\n    }, _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);\n  }\n\n  VariantListContainer.prototype.componentWillReceiveProps = function () {\n    function componentWillReceiveProps() {\n      this.setState({});\n    }\n\n    return componentWillReceiveProps;\n  }();\n\n  VariantListContainer.prototype.render = function () {\n    function render() {\n      return React.createElement(\n        DragDropProvider,\n        null,\n        React.createElement(VariantList, (0, _extends3.default)({\n          onEditVariant: this.handleEditVariant,\n          onMoveVariant: this.handleMoveVariant,\n          onVariantClick: this.handleVariantClick,\n          onVariantVisibiltyToggle: this.handleVariantVisibilityToggle,\n          onCreateVariant: this.handleCreateVariant\n        }, this.props, {\n          variants: this.variants\n        }))\n      );\n    }\n\n    return render;\n  }();\n\n  (0, _createClass3.default)(VariantListContainer, [{\n    key: \"variants\",\n    get: function () {\n      return this.state && this.state.variants || this.props.variants;\n    }\n  }, {\n    key: \"productHandle\",\n    get: function () {\n      var selectedProduct = ReactionProduct.selectedProduct();\n      return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n    }\n  }]);\n  return VariantListContainer;\n}(Component);\n\nfunction composer(props, onData) {\n  var childVariantMedia = [];\n  var childVariants = getChildVariants();\n\n  if (Array.isArray(childVariants)) {\n    childVariantMedia = Media.find({\n      \"metadata.variantId\": {\n        $in: getVariantIds(childVariants)\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    }).fetch();\n  }\n\n  var editable = void 0;\n\n  if (Reaction.isPreview() === true) {\n    editable = false;\n  } else {\n    editable = Reaction.hasPermission([\"createProduct\"]);\n  }\n\n  onData(null, {\n    variants: getTopVariants(),\n    variantIsSelected: variantIsSelected,\n    variantIsInActionView: variantIsInActionView,\n    childVariants: childVariants,\n    childVariantMedia: childVariantMedia,\n    displayPrice: ReactionProduct.getVariantPriceRange,\n    isSoldOut: isSoldOut,\n    editable: editable\n  });\n}\n\nVariantListContainer.propTypes = {\n  variants: PropTypes.arrayOf(PropTypes.object)\n};\nmodule.export(\"default\", exports.default = composeWithTracker(composer)(VariantListContainer));","map":{"version":3,"sources":["/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js"],"names":["React","Component","PropTypes","composeWithTracker","ReactionProduct","Reaction","i18next","VariantList","getChildVariants","Products","Media","update","getVariantIds","DragDropProvider","variantIsSelected","variantId","current","selectedVariant","_id","ancestors","indexOf","variantIsInActionView","actionViewVariant","getActionView","data","isActionViewOpen","getTopVariants","inventoryTotal","variants","length","variant","inventoryManagement","qty","getVariantQuantity","inventoryPercentage","parseInt","title","inventoryWidth","sort","a","b","index","isSoldOut","VariantListContainer","componentWillReceiveProps","setState","state","props","productHandle","selectedProduct","__published","handle","handleCreateVariant","Meteor","call","error","Alerts","alert","text","t","confirmButtonText","defaultValue","handleVariantClick","event","handleEditVariant","setCurrentVariant","Session","set","Router","go","as","getQueryParam","editVariant","findOne","hasPermission","showActionView","label","i18nKeyLabel","template","handleVariantVisibilityToggle","variantIsVisible","handleMoveVariant","dragIndex","hoverIndex","newVariantOrder","$splice","defer","render","composer","onData","childVariantMedia","childVariants","Array","isArray","find","$in","fetch","editable","isPreview","displayPrice","getVariantPriceRange","propTypes","arrayOf","object"],"mappings":"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","file":"/imports/plugins/included/product-detail-simple/client/containers/variantListContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { VariantList } from \"../components\";\nimport { getChildVariants } from \"../selectors/variants\";\nimport { Products, Media } from \"/lib/collections\";\nimport update from \"react/lib/update\";\nimport { getVariantIds } from \"/lib/selectors/variants\";\nimport { DragDropProvider } from \"/imports/plugins/core/ui/client/providers\";\n\nfunction variantIsSelected(variantId) {\n  const current = ReactionProduct.selectedVariant();\n  if (current && typeof current === \"object\" && (variantId === current._id || ~current.ancestors.indexOf(variantId))) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction variantIsInActionView(variantId) {\n  const actionViewVariant = Reaction.getActionView().data;\n\n  if (actionViewVariant) {\n    // Check if the variant is selected, and also visible & selected in the action view\n    return variantIsSelected(variantId) && variantIsSelected(actionViewVariant._id) && Reaction.isActionViewOpen();\n  }\n\n  return false;\n}\n\nfunction getTopVariants() {\n  let inventoryTotal = 0;\n  const variants = ReactionProduct.getTopVariants();\n  if (variants.length) {\n    // calculate inventory total for all variants\n    for (const variant of variants) {\n      if (variant.inventoryManagement) {\n        const qty = ReactionProduct.getVariantQuantity(variant);\n        if (typeof qty === \"number\") {\n          inventoryTotal += qty;\n        }\n      }\n    }\n    // calculate percentage of total inventory of this product\n    for (const variant of variants) {\n      const qty = ReactionProduct.getVariantQuantity(variant);\n      variant.inventoryTotal = inventoryTotal;\n      if (variant.inventoryManagement && inventoryTotal) {\n        variant.inventoryPercentage = parseInt(qty / inventoryTotal * 100, 10);\n      } else {\n        // for cases when sellers doesn't use inventory we should always show\n        // \"green\" progress bar\n        variant.inventoryPercentage = 100;\n      }\n      if (variant.title) {\n        variant.inventoryWidth = parseInt(variant.inventoryPercentage -\n          variant.title.length, 10);\n      } else {\n        variant.inventoryWidth = 0;\n      }\n    }\n    // sort variants in correct order\n    variants.sort((a, b) => a.index - b.index);\n\n    return variants;\n  }\n  return [];\n}\n\nfunction isSoldOut(variant) {\n  return ReactionProduct.getVariantQuantity(variant) < 1;\n}\n\nclass VariantListContainer extends Component {\n  componentWillReceiveProps() {\n    this.setState({});\n  }\n\n  get variants() {\n    return (this.state && this.state.variants) || this.props.variants;\n  }\n\n  get productHandle() {\n    const selectedProduct = ReactionProduct.selectedProduct();\n    return selectedProduct.__published && selectedProduct.__published.handle || selectedProduct.handle;\n  }\n\n  handleCreateVariant = () => {\n    const selectedProduct =  ReactionProduct.selectedProduct();\n\n    Meteor.call(\"products/createVariant\", selectedProduct._id, (error) => {\n      if (error) {\n        Alerts.alert({\n          text: i18next.t(\"productDetailEdit.addVariantFail\", { title: selectedProduct.title }),\n          confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n        });\n      }\n    });\n  }\n\n  handleVariantClick = (event, variant, ancestors = -1) => {\n    if (Reaction.isActionViewOpen()) {\n      this.handleEditVariant(event, variant, ancestors);\n    } else {\n      ReactionProduct.setCurrentVariant(variant._id);\n      Session.set(\"variant-form-\" + variant._id, true);\n      Reaction.Router.go(\"product\", {\n        handle: this.productHandle,\n        variantId: variant._id\n      }, {\n        as: Reaction.Router.getQueryParam(\"as\")\n      });\n    }\n  }\n\n  handleEditVariant = (event, variant, ancestors = -1) => {\n    let editVariant = variant;\n    if (ancestors >= 0) {\n      editVariant = Products.findOne(variant.ancestors[ancestors]);\n    }\n\n    ReactionProduct.setCurrentVariant(variant._id);\n    Session.set(\"variant-form-\" + editVariant._id, true);\n    Reaction.Router.go(\"product\", {\n      handle: this.productHandle,\n      variantId: variant._id\n    }, {\n      as: Reaction.Router.getQueryParam(\"as\")\n    });\n\n    if (Reaction.hasPermission(\"createProduct\")) {\n      Reaction.showActionView({\n        label: \"Edit Variant\",\n        i18nKeyLabel: \"productDetailEdit.editVariant\",\n        template: \"variantForm\",\n        data: editVariant\n      });\n    }\n\n    // Prevent the default edit button `onEditButtonClick` function from running\n    return false;\n  }\n\n  handleVariantVisibilityToggle = (event, variant, variantIsVisible) => {\n    Meteor.call(\"products/updateProductField\", variant._id, \"isVisible\", variantIsVisible);\n  }\n\n  handleMoveVariant = (dragIndex, hoverIndex) => {\n    const variant = this.props.variants[dragIndex];\n\n    // Apply new sort order to variant list\n    const newVariantOrder = update(this.props.variants, {\n      $splice: [\n        [dragIndex, 1],\n        [hoverIndex, 0, variant]\n      ]\n    });\n\n    // Set local state so the component does't have to wait for a round-trip\n    // to the server to get the updated list of variants\n    this.setState({\n      variants: newVariantOrder\n    });\n\n    // Save the updated positions\n    Meteor.defer(() => {\n      Meteor.call(\"products/updateVariantsPosition\", getVariantIds(newVariantOrder));\n    });\n  }\n\n  render() {\n    return (\n      <DragDropProvider>\n        <VariantList\n          onEditVariant={this.handleEditVariant}\n          onMoveVariant={this.handleMoveVariant}\n          onVariantClick={this.handleVariantClick}\n          onVariantVisibiltyToggle={this.handleVariantVisibilityToggle}\n          onCreateVariant={this.handleCreateVariant}\n          {...this.props}\n          variants={this.variants}\n        />\n      </DragDropProvider>\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  let childVariantMedia = [];\n  const childVariants = getChildVariants();\n\n  if (Array.isArray(childVariants)) {\n    childVariantMedia = Media.find({\n      \"metadata.variantId\": {\n        $in: getVariantIds(childVariants)\n      }\n    }, {\n      sort: {\n        \"metadata.priority\": 1\n      }\n    }).fetch();\n  }\n\n  let editable;\n\n  if (Reaction.isPreview() === true) {\n    editable = false;\n  } else {\n    editable = Reaction.hasPermission([\"createProduct\"]);\n  }\n\n  onData(null, {\n    variants: getTopVariants(),\n    variantIsSelected,\n    variantIsInActionView,\n    childVariants,\n    childVariantMedia,\n    displayPrice: ReactionProduct.getVariantPriceRange,\n    isSoldOut: isSoldOut,\n    editable\n  });\n}\n\nVariantListContainer.propTypes = {\n  variants: PropTypes.arrayOf(PropTypes.object)\n};\n\nexport default composeWithTracker(composer)(VariantListContainer);\n"]},"hash":"47311e8b6d280839dc1e2f738f66cfff6e646bfc"}
