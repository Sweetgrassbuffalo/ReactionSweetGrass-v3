{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"semver","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"semver"}]},{"source":"meteor/underscore","imported":["_"],"specifiers":[{"kind":"named","imported":"_","local":"_"}]}],"exports":{"exported":["checkNpmVersions"],"specifiers":[{"kind":"local","local":"checkNpmVersions","exported":"checkNpmVersions"}]}}},"options":{"filename":"/packages/tmeasday:check-npm-versions/check-npm-versions.js","filenameRelative":"/packages/tmeasday:check-npm-versions/check-npm-versions.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/tmeasday:check-npm-versions/check-npm-versions.js.map","sourceFileName":"/packages/tmeasday:check-npm-versions/check-npm-versions.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"check-npm-versions"},"ignored":false,"code":"module.export({\n  checkNpmVersions: function () {\n    return checkNpmVersions;\n  }\n});\nvar semver = void 0;\nmodule.importSync(\"semver\", {\n  \"default\": function (v) {\n    semver = v;\n  }\n}, 0);\n\nvar _ = void 0;\n\nmodule.importSync(\"meteor/underscore\", {\n  _: function (v) {\n    _ = v;\n  }\n}, 1);\n\n// Returns:\n//   - true      if a version of the package in the range is installed\n//   - false     if no version is installed\n//   - version#  if incompatible version is installed\nvar compatibleVersionIsInstalled = function (name, range) {\n  try {\n    var installedVersion = require(name + \"/package.json\").version;\n\n    if (semver.satisfies(installedVersion, range)) {\n      return true;\n    } else {\n      return installedVersion;\n    }\n  } catch (e) {\n    // XXX add something to the tool to make this more reliable\n    var message = e.toString(); // One message comes out of the install npm package the other from npm directly\n\n    if (message.match(\"Cannot find module\") || message.match(\"Can't find npm module\")) {\n      return false;\n    } else {\n      throw e;\n    }\n  }\n};\n\nvar checkNpmVersions = function (packages, packageName) {\n  var failures = {};\n\n  _.forEach(packages, function (range, name) {\n    var failure = compatibleVersionIsInstalled(name, range);\n\n    if (failure !== true) {\n      failures[name] = failure;\n    }\n  });\n\n  if (_.keys(failures).length === 0) {\n    return true;\n  }\n\n  var errors = [];\n\n  _.forEach(failures, function (installed, name) {\n    var requirement = name + \"@\" + packages[name];\n\n    if (installed) {\n      errors.push(\" - \" + name + \"@\" + installed + \" installed, \" + requirement + \" needed\");\n    } else {\n      errors.push(\" - \" + name + \"@\" + packages[name] + \" not installed.\");\n    }\n  });\n\n  var qualifier = packageName ? \"(for \" + packageName + \") \" : '';\n  console.warn(\"WARNING: npm peer requirements \" + qualifier + \"not installed:\\n\" + errors.join('\\n') + \"\\n\\nRead more about installing npm peer dependencies:\\n  http://guide.meteor.com/using-packages.html#peer-npm-dependencies\\n\");\n};","map":{"version":3,"sources":["/packages/tmeasday:check-npm-versions/check-npm-versions.js"],"names":["module","export","checkNpmVersions","semver","importSync","v","_","compatibleVersionIsInstalled","name","range","installedVersion","require","version","satisfies","e","message","toString","match","packages","packageName","failures","forEach","failure","keys","length","errors","installed","requirement","push","qualifier","console","warn","join"],"mappings":"AAAAA,OAAOC,MAAP,CAAc;AAACC,oBAAiB;AAAA,WAAIA,gBAAJ;AAAA;AAAlB,CAAd;AAAuD,IAAIC,eAAJ;AAAWH,OAAOI,UAAP,CAAkB,QAAlB,EAA2B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACF,aAAOE,CAAP;AAAS;AAA9B,CAA3B,EAA2D,CAA3D;;AAA8D,IAAIC,UAAJ;;AAAMN,OAAOI,UAAP,CAAkB,mBAAlB,EAAsC;AAACE,KAAE,UAASD,CAAT,EAAW;AAACC,QAAED,CAAF;AAAI;AAAnB,CAAtC,EAA2D,CAA3D;;AAGtI;AACA;AACA;AACA;AACA,IAAME,+BAA+B,UAACC,IAAD,EAAOC,KAAP,EAAiB;AACpD,MAAI;AACF,QAAMC,mBAAmBC,QAAWH,IAAX,oBAAgCI,OAAzD;;AACA,QAAIT,OAAOU,SAAP,CAAiBH,gBAAjB,EAAmCD,KAAnC,CAAJ,EAA+C;AAC7C,aAAO,IAAP;AACD,KAFD,MAEO;AACL,aAAOC,gBAAP;AACD;AACF,GAPD,CAOE,OAAOI,CAAP,EAAU;AACV;AACA,QAAMC,UAAUD,EAAEE,QAAF,EAAhB,CAFU,CAGV;;AACA,QAAID,QAAQE,KAAR,CAAc,oBAAd,KAAuCF,QAAQE,KAAR,CAAc,uBAAd,CAA3C,EAAmF;AACjF,aAAO,KAAP;AACD,KAFD,MAEO;AACL,YAAMH,CAAN;AACD;AACF;AACF,CAlBD;;AAoBO,IAAMZ,mBAAmB,UAACgB,QAAD,EAAWC,WAAX,EAA2B;AACzD,MAAMC,WAAW,EAAjB;;AACAd,IAAEe,OAAF,CAAUH,QAAV,EAAoB,UAACT,KAAD,EAAQD,IAAR,EAAiB;AACnC,QAAMc,UAAUf,6BAA6BC,IAA7B,EAAmCC,KAAnC,CAAhB;;AACA,QAAIa,YAAY,IAAhB,EAAsB;AACpBF,eAASZ,IAAT,IAAiBc,OAAjB;AACD;AACF,GALD;;AAOA,MAAIhB,EAAEiB,IAAF,CAAOH,QAAP,EAAiBI,MAAjB,KAA4B,CAAhC,EAAmC;AACjC,WAAO,IAAP;AACD;;AAED,MAAMC,SAAS,EAAf;;AACAnB,IAAEe,OAAF,CAAUD,QAAV,EAAoB,UAACM,SAAD,EAAYlB,IAAZ,EAAqB;AACvC,QAAMmB,cAAiBnB,IAAjB,SAAyBU,SAASV,IAAT,CAA/B;;AAEA,QAAIkB,SAAJ,EAAe;AACbD,aAAOG,IAAP,SAAkBpB,IAAlB,SAA0BkB,SAA1B,oBAAkDC,WAAlD;AACD,KAFD,MAEO;AACLF,aAAOG,IAAP,SAAkBpB,IAAlB,SAA0BU,SAASV,IAAT,CAA1B;AACD;AACF,GARD;;AAUA,MAAMqB,YAAYV,wBAAsBA,WAAtB,UAAwC,EAA1D;AACAW,UAAQC,IAAR,qCAA+CF,SAA/C,wBACAJ,OAAOO,IAAP,CAAY,IAAZ,CADA;AAMD,CA/BM","file":"/packages/tmeasday:check-npm-versions/check-npm-versions.js.map","sourcesContent":["import semver from 'semver';\nimport { _ } from 'meteor/underscore';\n\n// Returns:\n//   - true      if a version of the package in the range is installed\n//   - false     if no version is installed\n//   - version#  if incompatible version is installed\nconst compatibleVersionIsInstalled = (name, range) => {\n  try {\n    const installedVersion = require(`${name}/package.json`).version;  \n    if (semver.satisfies(installedVersion, range)) {\n      return true;\n    } else {\n      return installedVersion;\n    }\n  } catch (e) {\n    // XXX add something to the tool to make this more reliable\n    const message = e.toString();\n    // One message comes out of the install npm package the other from npm directly\n    if (message.match(\"Cannot find module\") || message.match(\"Can't find npm module\")) {\n      return false;\n    } else {\n      throw e;\n    }\n  }\n};\n\nexport const checkNpmVersions = (packages, packageName) => {\n  const failures = {};\n  _.forEach(packages, (range, name) => {\n    const failure = compatibleVersionIsInstalled(name, range);\n    if (failure !== true) {\n      failures[name] = failure;\n    }\n  });\n\n  if (_.keys(failures).length === 0) {\n    return true;\n  }\n\n  const errors = [];\n  _.forEach(failures, (installed, name) => {\n    const requirement = `${name}@${packages[name]}`;\n\n    if (installed) {\n      errors.push(` - ${name}@${installed} installed, ${requirement} needed`);\n    } else {\n      errors.push(` - ${name}@${packages[name]} not installed.`);\n    }\n  });\n\n  const qualifier = packageName ? `(for ${packageName}) ` : '';\n  console.warn(`WARNING: npm peer requirements ${qualifier}not installed:\n${errors.join('\\n')}\n\nRead more about installing npm peer dependencies:\n  http://guide.meteor.com/using-packages.html#peer-npm-dependencies\n`);\n};\n"]},"hash":"a575f99961f99bdd554fb9fc2c5fdc0ed565879d"}
