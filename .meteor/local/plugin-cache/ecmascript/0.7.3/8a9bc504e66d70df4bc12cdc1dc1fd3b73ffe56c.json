{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","extends","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component","PropTypes"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"},{"kind":"named","imported":"PropTypes","local":"PropTypes"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"meteor/session","imported":["Session"],"specifiers":[{"kind":"named","imported":"Session","local":"Session"}]},{"source":"/lib/api/compose","imported":["composeWithTracker"],"specifiers":[{"kind":"named","imported":"composeWithTracker","local":"composeWithTracker"}]},{"source":"/lib/api","imported":["ReactionProduct"],"specifiers":[{"kind":"named","imported":"ReactionProduct","local":"ReactionProduct"}]},{"source":"/lib/collections","imported":["Packages"],"specifiers":[{"kind":"named","imported":"Packages","local":"Packages"}]},{"source":"/client/collections","imported":["Countries"],"specifiers":[{"kind":"named","imported":"Countries","local":"Countries"}]},{"source":"/client/api","imported":["Reaction","i18next"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"},{"kind":"named","imported":"i18next","local":"i18next"}]},{"source":"/imports/plugins/core/taxes/lib/collections","imported":["TaxCodes"],"specifiers":[{"kind":"named","imported":"TaxCodes","local":"TaxCodes"}]},{"source":"../components/variantForm","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"VariantForm"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js","filenameRelative":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/included/product-variant/client/containers/variantFormContainer.js"],"names":["React","Component","PropTypes","Meteor","Session","composeWithTracker","ReactionProduct","Packages","Countries","Reaction","i18next","TaxCodes","VariantForm","VariantFormContainer","constructor","props","state","isDeleted","variant","isProviderEnabled","bind","fetchTaxCodes","hasChildVariants","greyDisabledFields","removeVariant","restoreVariant","cloneVariant","handleVariantFieldSave","handleCardExpand","updateQuantityIfChildVariants","shopId","getShopId","provider","findOne","providerName","name","split","settings","enabled","_","filter","registry","o","provides","taxCodesArray","codes","find","taxCodeProvider","forEach","code","push","value","taxCode","label","checkChildVariants","_id","backgroundColor","cursor","title","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","call","error","text","defaultValue","setState","result","selectedVariantId","setCurrentVariant","productId","selectedProductId","variantId","set","fieldName","toast","message","forceUpdate","cardName","variantQuantity","getVariantQuantity","render","composer","onData","countries","fetch","productHandle","Router","getParam","clearActionView","subscribe","editFocus","get","propTypes","object"],"mappings":"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","file":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Packages } from \"/lib/collections\";\nimport { Countries } from \"/client/collections\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\nimport VariantForm from \"../components/variantForm\";\n\nclass VariantFormContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isDeleted: props.variant.isDeleted\n    };\n\n    this.isProviderEnabled = this.isProviderEnabled.bind(this);\n    this.fetchTaxCodes = this.fetchTaxCodes.bind(this);\n    this.hasChildVariants = this.hasChildVariants.bind(this);\n    this.greyDisabledFields = this.greyDisabledFields.bind(this);\n    this.removeVariant = this.removeVariant.bind(this);\n    this.restoreVariant = this.restoreVariant.bind(this);\n    this.cloneVariant = this.cloneVariant.bind(this);\n    this.handleVariantFieldSave = this.handleVariantFieldSave.bind(this);\n    this.handleCardExpand = this.handleCardExpand.bind(this);\n    this.updateQuantityIfChildVariants = this.updateQuantityIfChildVariants.bind(this);\n  }\n\n  isProviderEnabled = () => {\n    const shopId = Reaction.getShopId();\n\n    const provider = Packages.findOne({\n      \"shopId\": shopId,\n      \"registry.provides\": \"taxCodes\",\n      \"$where\": function () {\n        const providerName = this.name.split(\"-\")[1];\n        return this.settings[providerName].enabled;\n      }\n    });\n\n    if (provider) {\n      return true;\n    }\n    return false;\n  }\n\n  fetchTaxCodes = () => {\n    const shopId = Reaction.getShopId();\n    const provider = Packages.findOne({\n      \"shopId\": shopId,\n      \"registry.provides\": \"taxCodes\",\n      \"$where\": function () {\n        const providerName = _.filter(this.registry, (o) => o.provides === \"taxCodes\")[0].name.split(\"/\")[2];\n        return this.settings[providerName].enabled;\n      }\n    });\n    const taxCodesArray = [];\n\n    const codes = TaxCodes.find({\n      shopId: shopId,\n      taxCodeProvider: provider.name\n    });\n\n    codes.forEach(function (code) {\n      taxCodesArray.push({\n        value: code.taxCode,\n        label: `${code.taxCode} | ${code.label}`\n      });\n    });\n    return taxCodesArray;\n  }\n\n  hasChildVariants = (variant) => {\n    if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n      return true;\n    }\n    return false;\n  }\n\n  greyDisabledFields = (variant) => {\n    if (this.hasChildVariants(variant)) {\n      return { backgroundColor: \"lightgrey\", cursor: \"not-allowed\" };\n    }\n  }\n\n  restoreVariant = (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Restore\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = variant._id;\n        Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n              confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n            });\n          }\n          this.setState({\n            isDeleted: !this.state.isDeleted\n          });\n        });\n      }\n    });\n  }\n\n  removeVariant = (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Archive\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        this.setState({\n          isDeleted: !this.state.isDeleted\n        });\n        const id = variant._id;\n        Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n          if (result && ReactionProduct.selectedVariantId() === id) {\n            return ReactionProduct.setCurrentVariant(null);\n          }\n        });\n      }\n    });\n  }\n\n  cloneVariant =  (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n    const productId = ReactionProduct.selectedProductId();\n    if (!productId) {\n      return;\n    }\n    Meteor.call(\"products/cloneVariant\", productId, variant._id,\n     function (error, result) {\n       if (error) {\n         Alerts.alert({\n           text: i18next.t(\"productDetailEdit.cloneVariantFail\", { title }),\n           confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n         });\n       } else if (result) {\n         const variantId = result[0];\n\n         ReactionProduct.setCurrentVariant(variantId);\n         Session.set(\"variant-form-\" + variantId, true);\n       }\n     });\n  }\n\n  handleVariantFieldSave = (variantId, fieldName, value) => {\n    Meteor.call(\"products/updateProductField\", variantId, fieldName, value, (error) => {\n      if (error) {\n        Alerts.toast(error.message, \"error\");\n        this.forceUpdate();\n      }\n    });\n  }\n\n  handleCardExpand = (cardName) => {\n    Reaction.state.set(\"edit/focus\", cardName);\n  }\n\n  updateQuantityIfChildVariants =  (variant) => {\n    if (this.hasChildVariants(variant)) {\n      const variantQuantity = ReactionProduct.getVariantQuantity(variant);\n      return variantQuantity;\n    }\n  }\n\n  render() {\n    return (\n      <VariantForm\n        isProviderEnabled={this.isProviderEnabled}\n        fetchTaxCodes={this.fetchTaxCodes}\n        hasChildVariants={this.hasChildVariants}\n        greyDisabledFields={this.greyDisabledFields}\n        restoreVariant={this.restoreVariant}\n        removeVariant={this.removeVariant}\n        cloneVariant={this.cloneVariant}\n        onVariantFieldSave={this.handleVariantFieldSave}\n        onCardExpand={this.handleCardExpand}\n        onUpdateQuantityField={this.updateQuantityIfChildVariants}\n        isDeleted={this.state.isDeleted}\n        {...this.props}\n      />\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  const countries = Countries.find({}).fetch();\n\n  const productHandle = Reaction.Router.getParam(\"handle\");\n  if (!productHandle) {\n    Reaction.clearActionView();\n  }\n\n  Meteor.subscribe(\"TaxCodes\");\n\n  onData(null, {\n    countries,\n    variant: props.variant,\n    editFocus: Reaction.state.get(\"edit/focus\")\n  });\n}\n\nVariantFormContainer.propTypes = {\n  variant: PropTypes.object\n};\n\nexport default composeWithTracker(composer)(VariantFormContainer);\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js.map","sourceFileName":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"variantFormContainer"},"ignored":false,"code":"var _extends2 = require(\"babel-runtime/helpers/extends\");\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    Component = void 0,\n    PropTypes = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  }\n}, 0);\nvar Meteor = void 0;\nmodule.importSync(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Session = void 0;\nmodule.importSync(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar composeWithTracker = void 0;\nmodule.importSync(\"/lib/api/compose\", {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 3);\nvar ReactionProduct = void 0;\nmodule.importSync(\"/lib/api\", {\n  ReactionProduct: function (v) {\n    ReactionProduct = v;\n  }\n}, 4);\nvar Packages = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Packages: function (v) {\n    Packages = v;\n  }\n}, 5);\nvar Countries = void 0;\nmodule.importSync(\"/client/collections\", {\n  Countries: function (v) {\n    Countries = v;\n  }\n}, 6);\nvar Reaction = void 0,\n    i18next = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  },\n  i18next: function (v) {\n    i18next = v;\n  }\n}, 7);\nvar TaxCodes = void 0;\nmodule.importSync(\"/imports/plugins/core/taxes/lib/collections\", {\n  TaxCodes: function (v) {\n    TaxCodes = v;\n  }\n}, 8);\nvar VariantForm = void 0;\nmodule.importSync(\"../components/variantForm\", {\n  \"default\": function (v) {\n    VariantForm = v;\n  }\n}, 9);\n\nvar VariantFormContainer = function (_Component) {\n  (0, _inherits3.default)(VariantFormContainer, _Component);\n\n  function VariantFormContainer(props) {\n    (0, _classCallCheck3.default)(this, VariantFormContainer);\n\n    var _this = (0, _possibleConstructorReturn3.default)(this, _Component.call(this, props));\n\n    _this.isProviderEnabled = function () {\n      var shopId = Reaction.getShopId();\n      var provider = Packages.findOne({\n        \"shopId\": shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\": function () {\n          var providerName = this.name.split(\"-\")[1];\n          return this.settings[providerName].enabled;\n        }\n      });\n\n      if (provider) {\n        return true;\n      }\n\n      return false;\n    };\n\n    _this.fetchTaxCodes = function () {\n      var shopId = Reaction.getShopId();\n      var provider = Packages.findOne({\n        \"shopId\": shopId,\n        \"registry.provides\": \"taxCodes\",\n        \"$where\": function () {\n          var providerName = _.filter(this.registry, function (o) {\n            return o.provides === \"taxCodes\";\n          })[0].name.split(\"/\")[2];\n\n          return this.settings[providerName].enabled;\n        }\n      });\n      var taxCodesArray = [];\n      var codes = TaxCodes.find({\n        shopId: shopId,\n        taxCodeProvider: provider.name\n      });\n      codes.forEach(function (code) {\n        taxCodesArray.push({\n          value: code.taxCode,\n          label: code.taxCode + \" | \" + code.label\n        });\n      });\n      return taxCodesArray;\n    };\n\n    _this.hasChildVariants = function (variant) {\n      if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n        return true;\n      }\n\n      return false;\n    };\n\n    _this.greyDisabledFields = function (variant) {\n      if (_this.hasChildVariants(variant)) {\n        return {\n          backgroundColor: \"lightgrey\",\n          cursor: \"not-allowed\"\n        };\n      }\n    };\n\n    _this.restoreVariant = function (variant) {\n      var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", {\n          title: title\n        }),\n        showCancelButton: true,\n        confirmButtonText: \"Restore\"\n      }, function (isConfirm) {\n        if (isConfirm) {\n          var id = variant._id;\n          Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, function (error) {\n            if (error) {\n              Alerts.alert({\n                text: i18next.t(\"productDetailEdit.restoreVariantFail\", {\n                  title: title\n                }),\n                confirmButtonText: i18next.t(\"app.close\", {\n                  defaultValue: \"Close\"\n                })\n              });\n            }\n\n            _this.setState({\n              isDeleted: !_this.state.isDeleted\n            });\n          });\n        }\n      });\n    };\n\n    _this.removeVariant = function (variant) {\n      var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n      Alerts.alert({\n        title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", {\n          title: title\n        }),\n        showCancelButton: true,\n        confirmButtonText: \"Archive\"\n      }, function (isConfirm) {\n        if (isConfirm) {\n          _this.setState({\n            isDeleted: !_this.state.isDeleted\n          });\n\n          var id = variant._id;\n          Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n            if (result && ReactionProduct.selectedVariantId() === id) {\n              return ReactionProduct.setCurrentVariant(null);\n            }\n          });\n        }\n      });\n    };\n\n    _this.cloneVariant = function (variant) {\n      var title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n      var productId = ReactionProduct.selectedProductId();\n\n      if (!productId) {\n        return;\n      }\n\n      Meteor.call(\"products/cloneVariant\", productId, variant._id, function (error, result) {\n        if (error) {\n          Alerts.alert({\n            text: i18next.t(\"productDetailEdit.cloneVariantFail\", {\n              title: title\n            }),\n            confirmButtonText: i18next.t(\"app.close\", {\n              defaultValue: \"Close\"\n            })\n          });\n        } else if (result) {\n          var variantId = result[0];\n          ReactionProduct.setCurrentVariant(variantId);\n          Session.set(\"variant-form-\" + variantId, true);\n        }\n      });\n    };\n\n    _this.handleVariantFieldSave = function (variantId, fieldName, value) {\n      Meteor.call(\"products/updateProductField\", variantId, fieldName, value, function (error) {\n        if (error) {\n          Alerts.toast(error.message, \"error\");\n\n          _this.forceUpdate();\n        }\n      });\n    };\n\n    _this.handleCardExpand = function (cardName) {\n      Reaction.state.set(\"edit/focus\", cardName);\n    };\n\n    _this.updateQuantityIfChildVariants = function (variant) {\n      if (_this.hasChildVariants(variant)) {\n        var variantQuantity = ReactionProduct.getVariantQuantity(variant);\n        return variantQuantity;\n      }\n    };\n\n    _this.state = {\n      isDeleted: props.variant.isDeleted\n    };\n    _this.isProviderEnabled = _this.isProviderEnabled.bind(_this);\n    _this.fetchTaxCodes = _this.fetchTaxCodes.bind(_this);\n    _this.hasChildVariants = _this.hasChildVariants.bind(_this);\n    _this.greyDisabledFields = _this.greyDisabledFields.bind(_this);\n    _this.removeVariant = _this.removeVariant.bind(_this);\n    _this.restoreVariant = _this.restoreVariant.bind(_this);\n    _this.cloneVariant = _this.cloneVariant.bind(_this);\n    _this.handleVariantFieldSave = _this.handleVariantFieldSave.bind(_this);\n    _this.handleCardExpand = _this.handleCardExpand.bind(_this);\n    _this.updateQuantityIfChildVariants = _this.updateQuantityIfChildVariants.bind(_this);\n    return _this;\n  }\n\n  VariantFormContainer.prototype.render = function () {\n    function render() {\n      return React.createElement(VariantForm, (0, _extends3.default)({\n        isProviderEnabled: this.isProviderEnabled,\n        fetchTaxCodes: this.fetchTaxCodes,\n        hasChildVariants: this.hasChildVariants,\n        greyDisabledFields: this.greyDisabledFields,\n        restoreVariant: this.restoreVariant,\n        removeVariant: this.removeVariant,\n        cloneVariant: this.cloneVariant,\n        onVariantFieldSave: this.handleVariantFieldSave,\n        onCardExpand: this.handleCardExpand,\n        onUpdateQuantityField: this.updateQuantityIfChildVariants,\n        isDeleted: this.state.isDeleted\n      }, this.props));\n    }\n\n    return render;\n  }();\n\n  return VariantFormContainer;\n}(Component);\n\nfunction composer(props, onData) {\n  var countries = Countries.find({}).fetch();\n  var productHandle = Reaction.Router.getParam(\"handle\");\n\n  if (!productHandle) {\n    Reaction.clearActionView();\n  }\n\n  Meteor.subscribe(\"TaxCodes\");\n  onData(null, {\n    countries: countries,\n    variant: props.variant,\n    editFocus: Reaction.state.get(\"edit/focus\")\n  });\n}\n\nVariantFormContainer.propTypes = {\n  variant: PropTypes.object\n};\nmodule.export(\"default\", exports.default = composeWithTracker(composer)(VariantFormContainer));","map":{"version":3,"sources":["/imports/plugins/included/product-variant/client/containers/variantFormContainer.js"],"names":["React","Component","PropTypes","Meteor","Session","composeWithTracker","ReactionProduct","Packages","Countries","Reaction","i18next","TaxCodes","VariantForm","VariantFormContainer","constructor","props","state","isDeleted","variant","isProviderEnabled","bind","fetchTaxCodes","hasChildVariants","greyDisabledFields","removeVariant","restoreVariant","cloneVariant","handleVariantFieldSave","handleCardExpand","updateQuantityIfChildVariants","shopId","getShopId","provider","findOne","providerName","name","split","settings","enabled","_","filter","registry","o","provides","taxCodesArray","codes","find","taxCodeProvider","forEach","code","push","value","taxCode","label","checkChildVariants","_id","backgroundColor","cursor","title","t","Alerts","alert","showCancelButton","confirmButtonText","isConfirm","id","call","error","text","defaultValue","setState","result","selectedVariantId","setCurrentVariant","productId","selectedProductId","variantId","set","fieldName","toast","message","forceUpdate","cardName","variantQuantity","getVariantQuantity","render","composer","onData","countries","fetch","productHandle","Router","getParam","clearActionView","subscribe","editFocus","get","propTypes","object"],"mappings":"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","file":"/imports/plugins/included/product-variant/client/containers/variantFormContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Session } from \"meteor/session\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { ReactionProduct } from \"/lib/api\";\nimport { Packages } from \"/lib/collections\";\nimport { Countries } from \"/client/collections\";\nimport { Reaction, i18next } from \"/client/api\";\nimport { TaxCodes } from \"/imports/plugins/core/taxes/lib/collections\";\nimport VariantForm from \"../components/variantForm\";\n\nclass VariantFormContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isDeleted: props.variant.isDeleted\n    };\n\n    this.isProviderEnabled = this.isProviderEnabled.bind(this);\n    this.fetchTaxCodes = this.fetchTaxCodes.bind(this);\n    this.hasChildVariants = this.hasChildVariants.bind(this);\n    this.greyDisabledFields = this.greyDisabledFields.bind(this);\n    this.removeVariant = this.removeVariant.bind(this);\n    this.restoreVariant = this.restoreVariant.bind(this);\n    this.cloneVariant = this.cloneVariant.bind(this);\n    this.handleVariantFieldSave = this.handleVariantFieldSave.bind(this);\n    this.handleCardExpand = this.handleCardExpand.bind(this);\n    this.updateQuantityIfChildVariants = this.updateQuantityIfChildVariants.bind(this);\n  }\n\n  isProviderEnabled = () => {\n    const shopId = Reaction.getShopId();\n\n    const provider = Packages.findOne({\n      \"shopId\": shopId,\n      \"registry.provides\": \"taxCodes\",\n      \"$where\": function () {\n        const providerName = this.name.split(\"-\")[1];\n        return this.settings[providerName].enabled;\n      }\n    });\n\n    if (provider) {\n      return true;\n    }\n    return false;\n  }\n\n  fetchTaxCodes = () => {\n    const shopId = Reaction.getShopId();\n    const provider = Packages.findOne({\n      \"shopId\": shopId,\n      \"registry.provides\": \"taxCodes\",\n      \"$where\": function () {\n        const providerName = _.filter(this.registry, (o) => o.provides === \"taxCodes\")[0].name.split(\"/\")[2];\n        return this.settings[providerName].enabled;\n      }\n    });\n    const taxCodesArray = [];\n\n    const codes = TaxCodes.find({\n      shopId: shopId,\n      taxCodeProvider: provider.name\n    });\n\n    codes.forEach(function (code) {\n      taxCodesArray.push({\n        value: code.taxCode,\n        label: `${code.taxCode} | ${code.label}`\n      });\n    });\n    return taxCodesArray;\n  }\n\n  hasChildVariants = (variant) => {\n    if (ReactionProduct.checkChildVariants(variant._id) > 0) {\n      return true;\n    }\n    return false;\n  }\n\n  greyDisabledFields = (variant) => {\n    if (this.hasChildVariants(variant)) {\n      return { backgroundColor: \"lightgrey\", cursor: \"not-allowed\" };\n    }\n  }\n\n  restoreVariant = (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.restoreVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Restore\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        const id = variant._id;\n        Meteor.call(\"products/updateProductField\", id, \"isDeleted\", false, (error) => {\n          if (error) {\n            Alerts.alert({\n              text: i18next.t(\"productDetailEdit.restoreVariantFail\", { title }),\n              confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n            });\n          }\n          this.setState({\n            isDeleted: !this.state.isDeleted\n          });\n        });\n      }\n    });\n  }\n\n  removeVariant = (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n\n    Alerts.alert({\n      title: i18next.t(\"productDetailEdit.archiveVariantConfirm\", { title }),\n      showCancelButton: true,\n      confirmButtonText: \"Archive\"\n    }, (isConfirm) => {\n      if (isConfirm) {\n        this.setState({\n          isDeleted: !this.state.isDeleted\n        });\n        const id = variant._id;\n        Meteor.call(\"products/deleteVariant\", id, function (error, result) {\n          if (result && ReactionProduct.selectedVariantId() === id) {\n            return ReactionProduct.setCurrentVariant(null);\n          }\n        });\n      }\n    });\n  }\n\n  cloneVariant =  (variant) => {\n    const title = variant.title || i18next.t(\"productDetailEdit.thisVariant\");\n    const productId = ReactionProduct.selectedProductId();\n    if (!productId) {\n      return;\n    }\n    Meteor.call(\"products/cloneVariant\", productId, variant._id,\n     function (error, result) {\n       if (error) {\n         Alerts.alert({\n           text: i18next.t(\"productDetailEdit.cloneVariantFail\", { title }),\n           confirmButtonText: i18next.t(\"app.close\", { defaultValue: \"Close\" })\n         });\n       } else if (result) {\n         const variantId = result[0];\n\n         ReactionProduct.setCurrentVariant(variantId);\n         Session.set(\"variant-form-\" + variantId, true);\n       }\n     });\n  }\n\n  handleVariantFieldSave = (variantId, fieldName, value) => {\n    Meteor.call(\"products/updateProductField\", variantId, fieldName, value, (error) => {\n      if (error) {\n        Alerts.toast(error.message, \"error\");\n        this.forceUpdate();\n      }\n    });\n  }\n\n  handleCardExpand = (cardName) => {\n    Reaction.state.set(\"edit/focus\", cardName);\n  }\n\n  updateQuantityIfChildVariants =  (variant) => {\n    if (this.hasChildVariants(variant)) {\n      const variantQuantity = ReactionProduct.getVariantQuantity(variant);\n      return variantQuantity;\n    }\n  }\n\n  render() {\n    return (\n      <VariantForm\n        isProviderEnabled={this.isProviderEnabled}\n        fetchTaxCodes={this.fetchTaxCodes}\n        hasChildVariants={this.hasChildVariants}\n        greyDisabledFields={this.greyDisabledFields}\n        restoreVariant={this.restoreVariant}\n        removeVariant={this.removeVariant}\n        cloneVariant={this.cloneVariant}\n        onVariantFieldSave={this.handleVariantFieldSave}\n        onCardExpand={this.handleCardExpand}\n        onUpdateQuantityField={this.updateQuantityIfChildVariants}\n        isDeleted={this.state.isDeleted}\n        {...this.props}\n      />\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  const countries = Countries.find({}).fetch();\n\n  const productHandle = Reaction.Router.getParam(\"handle\");\n  if (!productHandle) {\n    Reaction.clearActionView();\n  }\n\n  Meteor.subscribe(\"TaxCodes\");\n\n  onData(null, {\n    countries,\n    variant: props.variant,\n    editFocus: Reaction.state.get(\"edit/focus\")\n  });\n}\n\nVariantFormContainer.propTypes = {\n  variant: PropTypes.object\n};\n\nexport default composeWithTracker(composer)(VariantFormContainer);\n"]},"hash":"8a9bc504e66d70df4bc12cdc1dc1fd3b73ffe56c"}
