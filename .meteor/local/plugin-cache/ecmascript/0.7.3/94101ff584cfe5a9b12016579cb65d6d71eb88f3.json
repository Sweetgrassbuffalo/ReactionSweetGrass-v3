{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"/client/api","imported":["Reaction"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"}]},{"source":"/lib/collections","imported":["Media","Products"],"specifiers":[{"kind":"named","imported":"Media","local":"Media"},{"kind":"named","imported":"Products","local":"Products"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/core/dashboard/client/templates/import/import.js","filenameRelative":"/imports/plugins/core/dashboard/client/templates/import/import.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/core/dashboard/client/templates/import/import.js"],"names":["Reaction","Media","Products","uploadHandler","event","shopId","getShopId","userId","Meteor","files","target","i","length","parts","name","split","product","findOne","variants","$elemMatch","barcode","fileObj","FS","File","metadata","ownerId","productId","_id","variantId","priority","Number","insert","Template","import","events","preventDefault"],"mappings":"AAAA,IAAS;AAAT,OAAyB,WAAzB;;;;;;;;;;;;;;GACA,AAAS,AAAO,AAAgB;;AAEhC,SAAA,AAAS,cAAT,AAAuB,OAAO,AAC5B;MAAM,SAAS,SAAf,AAAe,AAAS,AACxB;MAAM,SAAS,OAAf,AAAe,AAAO,AACtB;MAAM,QAAQ,MAAA,AAAM,OAAN,AAAa,MAA3B,AAAiC,AAEjC;;OAAK,IAAI,IAAT,AAAa,GAAG,IAAI,MAApB,AAA0B,QAA1B,AAAkC,KAAK,AACrC;QAAM,QAAQ,MAAA,AAAM,GAAN,AAAS,KAAT,AAAc,MAA5B,AAAc,AAAoB,AAClC;QAAA,AAAI;;kBACJ;AAAI,AAAM;AACE,AAAS,4BAAT,AAAiB,MACzB;AADF,OADF,AAAc;AAGT;AACS;qBACI,MAFb,AACS,AACI,AACV,AAAS,AAAM;AADjB;AADF;AAHQ,AAAiB,AACL,AAAM;AAD5B,AAAU,AASX;;;sCACD;AAAI,cAAJ,AAAa;AACL,iBAAN,AAAgB,AAAI,AAAG,AAAK,AAAM,AAClC;AAAQ,mBAAR,AAAmB,QACjB;AAAS,mBADQ,oBAEjB;gBAFiB,AAEN,AAAQ,AACnB;kBAAW,OAAQ,MAAR,AAAiB,OAHX,AAGc,AAC/B,AAAQ,AACR;AANF;YAMY,OALO,AAKP,AAAO,AAAM,AAAO;AALhC,AAOA;AAAA,AAAM,AAAO,AACd;AACF;;AACF;qDAED;AAAS,UAAT,AAAgB,AAAO,AACrB;kBAAkC,AAAU,AAAO,AACjD;AAFJ,AAAuB,AAEnB,AAAM,AACN,AAAc,AACf","file":"/imports/plugins/core/dashboard/client/templates/import/import.js.map","sourcesContent":["import { Reaction } from \"/client/api\";\nimport { Media, Products } from \"/lib/collections\";\n\nfunction uploadHandler(event) {\n  const shopId = Reaction.getShopId();\n  const userId = Meteor.userId();\n  const files = event.target.files.files;\n\n  for (let i = 0; i < files.length; i++) {\n    const parts = files[i].name.split(\".\");\n    let product;\n    if (parts[0]) {\n      product = Products.findOne({\n        \"variants.barcode\": parts[0]\n      }, {\n        variants: {\n          $elemMatch: {\n            barcode: parts[0]\n          }\n        }\n      });\n    }\n    if (product) {\n      const fileObj = new FS.File(files[i]);\n      fileObj.metadata = {\n        ownerId: userId,\n        productId: product._id,\n        variantId: product.variants[0]._id,\n        shopId: shopId,\n        priority: Number(parts[1]) || 0\n      };\n      Media.insert(fileObj);\n    }\n  }\n}\n\nTemplate.import.events({\n  \"submit form#form-import-images\": function (event) {\n    event.preventDefault();\n    uploadHandler(event);\n  }\n});\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/core/dashboard/client/templates/import/import.js.map","sourceFileName":"/imports/plugins/core/dashboard/client/templates/import/import.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"import"},"ignored":false,"code":"var Reaction = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 0);\nvar Media = void 0,\n    Products = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Media: function (v) {\n    Media = v;\n  },\n  Products: function (v) {\n    Products = v;\n  }\n}, 1);\n\nfunction uploadHandler(event) {\n  var shopId = Reaction.getShopId();\n  var userId = Meteor.userId();\n  var files = event.target.files.files;\n\n  for (var i = 0; i < files.length; i++) {\n    var parts = files[i].name.split(\".\");\n    var product = void 0;\n\n    if (parts[0]) {\n      product = Products.findOne({\n        \"variants.barcode\": parts[0]\n      }, {\n        variants: {\n          $elemMatch: {\n            barcode: parts[0]\n          }\n        }\n      });\n    }\n\n    if (product) {\n      var fileObj = new FS.File(files[i]);\n      fileObj.metadata = {\n        ownerId: userId,\n        productId: product._id,\n        variantId: product.variants[0]._id,\n        shopId: shopId,\n        priority: Number(parts[1]) || 0\n      };\n      Media.insert(fileObj);\n    }\n  }\n}\n\nTemplate.import.events({\n  \"submit form#form-import-images\": function (event) {\n    event.preventDefault();\n    uploadHandler(event);\n  }\n});","map":{"version":3,"sources":["/imports/plugins/core/dashboard/client/templates/import/import.js"],"names":["Reaction","Media","Products","uploadHandler","event","shopId","getShopId","userId","Meteor","files","target","i","length","parts","name","split","product","findOne","variants","$elemMatch","barcode","fileObj","FS","File","metadata","ownerId","productId","_id","variantId","priority","Number","insert","Template","import","events","preventDefault"],"mappings":"AAAA,IAAS;AAAT,OAAyB,WAAzB;;;;;;;;;;;;;;GACA,AAAS,AAAO,AAAgB;;AAEhC,SAAA,AAAS,cAAT,AAAuB,OAAO,AAC5B;MAAM,SAAS,SAAf,AAAe,AAAS,AACxB;MAAM,SAAS,OAAf,AAAe,AAAO,AACtB;MAAM,QAAQ,MAAA,AAAM,OAAN,AAAa,MAA3B,AAAiC,AAEjC;;OAAK,IAAI,IAAT,AAAa,GAAG,IAAI,MAApB,AAA0B,QAA1B,AAAkC,KAAK,AACrC;QAAM,QAAQ,MAAA,AAAM,GAAN,AAAS,KAAT,AAAc,MAA5B,AAAc,AAAoB,AAClC;QAAA,AAAI;;kBACJ;AAAI,AAAM;AACE,AAAS,4BAAT,AAAiB,MACzB;AADF,OADF,AAAc;AAGT;AACS;qBACI,MAFb,AACS,AACI,AACV,AAAS,AAAM;AADjB;AADF;AAHQ,AAAiB,AACL,AAAM;AAD5B,AAAU,AASX;;;sCACD;AAAI,cAAJ,AAAa;AACL,iBAAN,AAAgB,AAAI,AAAG,AAAK,AAAM,AAClC;AAAQ,mBAAR,AAAmB,QACjB;AAAS,mBADQ,oBAEjB;gBAFiB,AAEN,AAAQ,AACnB;kBAAW,OAAQ,MAAR,AAAiB,OAHX,AAGc,AAC/B,AAAQ,AACR;AANF;YAMY,OALO,AAKP,AAAO,AAAM,AAAO;AALhC,AAOA;AAAA,AAAM,AAAO,AACd;AACF;;AACF;qDAED;AAAS,UAAT,AAAgB,AAAO,AACrB;kBAAkC,AAAU,AAAO,AACjD;AAFJ,AAAuB,AAEnB,AAAM,AACN,AAAc,AACf","file":"/imports/plugins/core/dashboard/client/templates/import/import.js.map","sourcesContent":["import { Reaction } from \"/client/api\";\nimport { Media, Products } from \"/lib/collections\";\n\nfunction uploadHandler(event) {\n  const shopId = Reaction.getShopId();\n  const userId = Meteor.userId();\n  const files = event.target.files.files;\n\n  for (let i = 0; i < files.length; i++) {\n    const parts = files[i].name.split(\".\");\n    let product;\n    if (parts[0]) {\n      product = Products.findOne({\n        \"variants.barcode\": parts[0]\n      }, {\n        variants: {\n          $elemMatch: {\n            barcode: parts[0]\n          }\n        }\n      });\n    }\n    if (product) {\n      const fileObj = new FS.File(files[i]);\n      fileObj.metadata = {\n        ownerId: userId,\n        productId: product._id,\n        variantId: product.variants[0]._id,\n        shopId: shopId,\n        priority: Number(parts[1]) || 0\n      };\n      Media.insert(fileObj);\n    }\n  }\n}\n\nTemplate.import.events({\n  \"submit form#form-import-images\": function (event) {\n    event.preventDefault();\n    uploadHandler(event);\n  }\n});\n"]},"hash":"94101ff584cfe5a9b12016579cb65d6d71eb88f3"}
