{"metadata":{"usedHelpers":["inherits","possibleConstructorReturn","classCallCheck","interopRequireDefault"],"marked":[],"modules":{"imports":[{"source":"react","imported":["default","Component","PropTypes"],"specifiers":[{"kind":"named","imported":"default","local":"React"},{"kind":"named","imported":"Component","local":"Component"},{"kind":"named","imported":"PropTypes","local":"PropTypes"}]},{"source":"meteor/session","imported":["Session"],"specifiers":[{"kind":"named","imported":"Session","local":"Session"}]},{"source":"meteor/meteor","imported":["Meteor"],"specifiers":[{"kind":"named","imported":"Meteor","local":"Meteor"}]},{"source":"/lib/collections","imported":["Cart","Media"],"specifiers":[{"kind":"named","imported":"Cart","local":"Cart"},{"kind":"named","imported":"Media","local":"Media"}]},{"source":"/client/api","imported":["Reaction"],"specifiers":[{"kind":"named","imported":"Reaction","local":"Reaction"}]},{"source":"/lib/api/compose","imported":["composeWithTracker"],"specifiers":[{"kind":"named","imported":"composeWithTracker","local":"composeWithTracker"}]},{"source":"/imports/plugins/core/ui/client/components","imported":["Loading"],"specifiers":[{"kind":"named","imported":"Loading","local":"Loading"}]},{"source":"../components/cartDrawer","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"CartDrawer"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js","filenameRelative":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js","inputSourceMap":{"version":3,"sources":["/imports/plugins/core/checkout/client/container/cartDrawerContainer.js"],"names":["React","Component","PropTypes","Session","Meteor","Cart","Media","Reaction","composeWithTracker","Loading","CartDrawer","CartDrawerContainer","propTypes","defaultImage","object","lowInventory","bool","productItems","array","handleImage","item","url","store","showItemLowInventoryWarning","productItem","variants","inventoryPolicy","lowInventoryWarningThreshold","inventoryQuantity","handleLowInventory","handleShowProduct","Router","go","handle","productId","variantId","_id","pdpPath","pathFor","hash","handleRemoveItem","event","stopPropagation","preventDefault","currentCartItemId","target","getAttribute","$","fadeOut","call","handleCheckout","set","render","props","composer","onData","userId","shopId","getShopId","findOne","items","map","subscribe","Object","assign"],"mappings":"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","file":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { Session } from \"meteor/session\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Cart, Media } from \"/lib/collections\";\nimport { Reaction } from \"/client/api\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { Loading } from \"/imports/plugins/core/ui/client/components\";\nimport CartDrawer from \"../components/cartDrawer\";\n\nclass CartDrawerContainer extends Component {\n  static propTypes = {\n    defaultImage: PropTypes.object,\n    lowInventory: PropTypes.bool,\n    productItems: PropTypes.array\n  }\n\n  handleImage(item) {\n    const { defaultImage } = item;\n    if (defaultImage && defaultImage.url({ store: \"small\" })) {\n      return defaultImage;\n    }\n    return false;\n  }\n  /**\n  * showLowInventoryWarning\n  * @param {Object} productItem - product item object\n  * @return {Boolean} return true if low inventory on variant\n  */\n  showItemLowInventoryWarning(productItem) {\n    const { variants } = productItem;\n    if (variants && variants.inventoryPolicy &&\n      variants.lowInventoryWarningThreshold) {\n      return variants.inventoryQuantity <=\n        variants.lowInventoryWarningThreshold;\n    }\n    return false;\n  }\n\n  handleLowInventory = (productItem) => {\n    return this.showItemLowInventoryWarning(productItem);\n  }\n\n  handleShowProduct = (productItem) => {\n    if (productItem) {\n      Reaction.Router.go(\"product\", {\n        handle: productItem.productId,\n        variantId: productItem.variants._id\n      });\n    }\n  }\n\n  pdpPath(productItem) {\n    if (productItem) {\n      const handle = productItem.productId;\n      return Reaction.Router.pathFor(\"product\", {\n        hash: {\n          handle,\n          variantId: productItem.variants._id\n        }\n      });\n    }\n  }\n\n  handleRemoveItem(event) {\n    event.stopPropagation();\n    event.preventDefault();\n    const currentCartItemId = event.target.getAttribute(\"id\");\n    $(`#${currentCartItemId}`).fadeOut(500, () => {\n      return Meteor.call(\"cart/removeFromCart\", currentCartItemId);\n    });\n  }\n  handleCheckout() {\n    $(\"#cart-drawer-container\").fadeOut();\n    Session.set(\"displayCart\", false);\n    return Reaction.Router.go(\"cart/checkout\");\n  }\n  render() {\n    const { productItems } = this.props;\n    return (\n      <CartDrawer\n        productItems={productItems}\n        pdpPath={this.pdpPath}\n        handleLowInventory={this.handleLowInventory}\n        handleImage={this.handleImage}\n        handleRemoveItem={this.handleRemoveItem}\n        handleCheckout={this.handleCheckout}\n        handleShowProduct={this.handleShowProduct}\n      />\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  const userId = Meteor.userId();\n  const shopId = Reaction.getShopId();\n  let productItems = Cart.findOne({ userId, shopId }).items;\n  let defaultImage;\n\n  productItems = productItems.map((item) => {\n    Meteor.subscribe(\"CartItemImage\", item);\n    defaultImage = Media.findOne({\n      \"metadata.variantId\": item.variants._id\n    });\n    if (defaultImage) {\n      return Object.assign({}, item, { defaultImage });\n    }\n    defaultImage = Media.findOne({\n      \"metadata.productId\": item.productId\n    });\n    return Object.assign({}, item, { defaultImage });\n  });\n  onData(null, {\n    productItems\n  });\n}\n\nexport default composeWithTracker(composer, Loading)(CartDrawerContainer);\n"]},"env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],null],[[],{"polyfill":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js.map","sourceFileName":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"cartDrawerContainer"},"ignored":false,"code":"var _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _possibleConstructorReturn2 = require(\"babel-runtime/helpers/possibleConstructorReturn\");\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require(\"babel-runtime/helpers/inherits\");\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nvar React = void 0,\n    Component = void 0,\n    PropTypes = void 0;\nmodule.importSync(\"react\", {\n  \"default\": function (v) {\n    React = v;\n  },\n  Component: function (v) {\n    Component = v;\n  },\n  PropTypes: function (v) {\n    PropTypes = v;\n  }\n}, 0);\nvar Session = void 0;\nmodule.importSync(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 1);\nvar Meteor = void 0;\nmodule.importSync(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 2);\nvar Cart = void 0,\n    Media = void 0;\nmodule.importSync(\"/lib/collections\", {\n  Cart: function (v) {\n    Cart = v;\n  },\n  Media: function (v) {\n    Media = v;\n  }\n}, 3);\nvar Reaction = void 0;\nmodule.importSync(\"/client/api\", {\n  Reaction: function (v) {\n    Reaction = v;\n  }\n}, 4);\nvar composeWithTracker = void 0;\nmodule.importSync(\"/lib/api/compose\", {\n  composeWithTracker: function (v) {\n    composeWithTracker = v;\n  }\n}, 5);\nvar Loading = void 0;\nmodule.importSync(\"/imports/plugins/core/ui/client/components\", {\n  Loading: function (v) {\n    Loading = v;\n  }\n}, 6);\nvar CartDrawer = void 0;\nmodule.importSync(\"../components/cartDrawer\", {\n  \"default\": function (v) {\n    CartDrawer = v;\n  }\n}, 7);\n\nvar CartDrawerContainer = function (_Component) {\n  (0, _inherits3.default)(CartDrawerContainer, _Component);\n\n  function CartDrawerContainer() {\n    var _temp, _this, _ret;\n\n    (0, _classCallCheck3.default)(this, CartDrawerContainer);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, _Component.call.apply(_Component, [this].concat(args))), _this), _this.handleLowInventory = function (productItem) {\n      return _this.showItemLowInventoryWarning(productItem);\n    }, _this.handleShowProduct = function (productItem) {\n      if (productItem) {\n        Reaction.Router.go(\"product\", {\n          handle: productItem.productId,\n          variantId: productItem.variants._id\n        });\n      }\n    }, _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);\n  }\n\n  CartDrawerContainer.prototype.handleImage = function () {\n    function handleImage(item) {\n      var defaultImage = item.defaultImage;\n\n      if (defaultImage && defaultImage.url({\n        store: \"small\"\n      })) {\n        return defaultImage;\n      }\n\n      return false;\n    }\n\n    return handleImage;\n  }(); /**\n       * showLowInventoryWarning\n       * @param {Object} productItem - product item object\n       * @return {Boolean} return true if low inventory on variant\n       */\n\n  CartDrawerContainer.prototype.showItemLowInventoryWarning = function () {\n    function showItemLowInventoryWarning(productItem) {\n      var variants = productItem.variants;\n\n      if (variants && variants.inventoryPolicy && variants.lowInventoryWarningThreshold) {\n        return variants.inventoryQuantity <= variants.lowInventoryWarningThreshold;\n      }\n\n      return false;\n    }\n\n    return showItemLowInventoryWarning;\n  }();\n\n  CartDrawerContainer.prototype.pdpPath = function () {\n    function pdpPath(productItem) {\n      if (productItem) {\n        var handle = productItem.productId;\n        return Reaction.Router.pathFor(\"product\", {\n          hash: {\n            handle: handle,\n            variantId: productItem.variants._id\n          }\n        });\n      }\n    }\n\n    return pdpPath;\n  }();\n\n  CartDrawerContainer.prototype.handleRemoveItem = function () {\n    function handleRemoveItem(event) {\n      event.stopPropagation();\n      event.preventDefault();\n      var currentCartItemId = event.target.getAttribute(\"id\");\n      $(\"#\" + currentCartItemId).fadeOut(500, function () {\n        return Meteor.call(\"cart/removeFromCart\", currentCartItemId);\n      });\n    }\n\n    return handleRemoveItem;\n  }();\n\n  CartDrawerContainer.prototype.handleCheckout = function () {\n    function handleCheckout() {\n      $(\"#cart-drawer-container\").fadeOut();\n      Session.set(\"displayCart\", false);\n      return Reaction.Router.go(\"cart/checkout\");\n    }\n\n    return handleCheckout;\n  }();\n\n  CartDrawerContainer.prototype.render = function () {\n    function render() {\n      var productItems = this.props.productItems;\n      return React.createElement(CartDrawer, {\n        productItems: productItems,\n        pdpPath: this.pdpPath,\n        handleLowInventory: this.handleLowInventory,\n        handleImage: this.handleImage,\n        handleRemoveItem: this.handleRemoveItem,\n        handleCheckout: this.handleCheckout,\n        handleShowProduct: this.handleShowProduct\n      });\n    }\n\n    return render;\n  }();\n\n  return CartDrawerContainer;\n}(Component);\n\nCartDrawerContainer.propTypes = {\n  defaultImage: PropTypes.object,\n  lowInventory: PropTypes.bool,\n  productItems: PropTypes.array\n};\n\nfunction composer(props, onData) {\n  var userId = Meteor.userId();\n  var shopId = Reaction.getShopId();\n  var productItems = Cart.findOne({\n    userId: userId,\n    shopId: shopId\n  }).items;\n  var defaultImage = void 0;\n  productItems = productItems.map(function (item) {\n    Meteor.subscribe(\"CartItemImage\", item);\n    defaultImage = Media.findOne({\n      \"metadata.variantId\": item.variants._id\n    });\n\n    if (defaultImage) {\n      return Object.assign({}, item, {\n        defaultImage: defaultImage\n      });\n    }\n\n    defaultImage = Media.findOne({\n      \"metadata.productId\": item.productId\n    });\n    return Object.assign({}, item, {\n      defaultImage: defaultImage\n    });\n  });\n  onData(null, {\n    productItems: productItems\n  });\n}\n\nmodule.export(\"default\", exports.default = composeWithTracker(composer, Loading)(CartDrawerContainer));","map":{"version":3,"sources":["/imports/plugins/core/checkout/client/container/cartDrawerContainer.js"],"names":["React","Component","PropTypes","Session","Meteor","Cart","Media","Reaction","composeWithTracker","Loading","CartDrawer","CartDrawerContainer","propTypes","defaultImage","object","lowInventory","bool","productItems","array","handleImage","item","url","store","showItemLowInventoryWarning","productItem","variants","inventoryPolicy","lowInventoryWarningThreshold","inventoryQuantity","handleLowInventory","handleShowProduct","Router","go","handle","productId","variantId","_id","pdpPath","pathFor","hash","handleRemoveItem","event","stopPropagation","preventDefault","currentCartItemId","target","getAttribute","$","fadeOut","call","handleCheckout","set","render","props","composer","onData","userId","shopId","getShopId","findOne","items","map","subscribe","Object","assign"],"mappings":"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","file":"/imports/plugins/core/checkout/client/container/cartDrawerContainer.js.map","sourcesContent":["import React, { Component, PropTypes } from \"react\";\nimport { Session } from \"meteor/session\";\nimport { Meteor } from \"meteor/meteor\";\nimport { Cart, Media } from \"/lib/collections\";\nimport { Reaction } from \"/client/api\";\nimport { composeWithTracker } from \"/lib/api/compose\";\nimport { Loading } from \"/imports/plugins/core/ui/client/components\";\nimport CartDrawer from \"../components/cartDrawer\";\n\nclass CartDrawerContainer extends Component {\n  static propTypes = {\n    defaultImage: PropTypes.object,\n    lowInventory: PropTypes.bool,\n    productItems: PropTypes.array\n  }\n\n  handleImage(item) {\n    const { defaultImage } = item;\n    if (defaultImage && defaultImage.url({ store: \"small\" })) {\n      return defaultImage;\n    }\n    return false;\n  }\n  /**\n  * showLowInventoryWarning\n  * @param {Object} productItem - product item object\n  * @return {Boolean} return true if low inventory on variant\n  */\n  showItemLowInventoryWarning(productItem) {\n    const { variants } = productItem;\n    if (variants && variants.inventoryPolicy &&\n      variants.lowInventoryWarningThreshold) {\n      return variants.inventoryQuantity <=\n        variants.lowInventoryWarningThreshold;\n    }\n    return false;\n  }\n\n  handleLowInventory = (productItem) => {\n    return this.showItemLowInventoryWarning(productItem);\n  }\n\n  handleShowProduct = (productItem) => {\n    if (productItem) {\n      Reaction.Router.go(\"product\", {\n        handle: productItem.productId,\n        variantId: productItem.variants._id\n      });\n    }\n  }\n\n  pdpPath(productItem) {\n    if (productItem) {\n      const handle = productItem.productId;\n      return Reaction.Router.pathFor(\"product\", {\n        hash: {\n          handle,\n          variantId: productItem.variants._id\n        }\n      });\n    }\n  }\n\n  handleRemoveItem(event) {\n    event.stopPropagation();\n    event.preventDefault();\n    const currentCartItemId = event.target.getAttribute(\"id\");\n    $(`#${currentCartItemId}`).fadeOut(500, () => {\n      return Meteor.call(\"cart/removeFromCart\", currentCartItemId);\n    });\n  }\n  handleCheckout() {\n    $(\"#cart-drawer-container\").fadeOut();\n    Session.set(\"displayCart\", false);\n    return Reaction.Router.go(\"cart/checkout\");\n  }\n  render() {\n    const { productItems } = this.props;\n    return (\n      <CartDrawer\n        productItems={productItems}\n        pdpPath={this.pdpPath}\n        handleLowInventory={this.handleLowInventory}\n        handleImage={this.handleImage}\n        handleRemoveItem={this.handleRemoveItem}\n        handleCheckout={this.handleCheckout}\n        handleShowProduct={this.handleShowProduct}\n      />\n    );\n  }\n}\n\nfunction composer(props, onData) {\n  const userId = Meteor.userId();\n  const shopId = Reaction.getShopId();\n  let productItems = Cart.findOne({ userId, shopId }).items;\n  let defaultImage;\n\n  productItems = productItems.map((item) => {\n    Meteor.subscribe(\"CartItemImage\", item);\n    defaultImage = Media.findOne({\n      \"metadata.variantId\": item.variants._id\n    });\n    if (defaultImage) {\n      return Object.assign({}, item, { defaultImage });\n    }\n    defaultImage = Media.findOne({\n      \"metadata.productId\": item.productId\n    });\n    return Object.assign({}, item, { defaultImage });\n  });\n  onData(null, {\n    productItems\n  });\n}\n\nexport default composeWithTracker(composer, Loading)(CartDrawerContainer);\n"]},"hash":"efd2d77e6875a9d5bf4428a3429e1451f6c60864"}
