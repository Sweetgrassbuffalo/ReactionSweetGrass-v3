[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar FS = Package['cfs:base-package'].FS;\nvar ECMAScript = Package.ecmascript.ECMAScript;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Buffer = Package.modules.Buffer;\nvar process = Package.modules.process;\nvar Symbol = Package['ecmascript-runtime'].Symbol;\nvar Map = Package['ecmascript-runtime'].Map;\nvar Set = Package['ecmascript-runtime'].Set;\nvar meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"cfs:gridfs\":{\"gridfs.server.js\":function(require){\n\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                     //\n// packages/cfs_gridfs/gridfs.server.js                                                                                //\n//                                                                                                                     //\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                       //\n/* eslint-disable */var path = Npm.require(\"path\");                                                                    // 1\n                                                                                                                       //\nvar mongodb = Npm.require(\"mongodb\");                                                                                  // 3\n                                                                                                                       //\nvar ObjectID = Npm.require(\"mongodb\").ObjectID;                                                                        // 4\n                                                                                                                       //\nvar Grid = Npm.require(\"gridfs-stream\"); // var Grid = Npm.require('gridfs-locking-stream');                           // 5\n                                                                                                                       //\n                                                                                                                       //\nvar chunkSize = 1024 * 1024 * 2; // 256k is default GridFS chunk size, but performs terribly for largish files         // 8\n/**                                                                                                                    // 10\n * @public                                                                                                             //\n * @constructor                                                                                                        //\n * @param {String} name - The store name                                                                               //\n * @param {Object} options                                                                                             //\n * @param {Function} [options.beforeSave] - Function to run before saving a file from the server. The context of the function will be the `FS.File` instance we're saving. The function may alter its properties.\n * @param {Number} [options.maxTries=5] - Max times to attempt saving a file                                           //\n * @returns {FS.StorageAdapter} An instance of FS.StorageAdapter.                                                      //\n *                                                                                                                     //\n * Creates a GridFS store instance on the server. Inherits from FS.StorageAdapter                                      //\n * type.                                                                                                               //\n */                                                                                                                    //\n                                                                                                                       //\nFS.Store.GridFS = function (name, options) {                                                                           // 23\n  var self = this;                                                                                                     // 24\n  options = options || {};                                                                                             // 25\n  var gridfsName = name;                                                                                               // 27\n  var mongoOptions = options.mongoOptions || {};                                                                       // 28\n                                                                                                                       //\n  if (!(self instanceof FS.Store.GridFS)) {                                                                            // 30\n    throw new Error('FS.Store.GridFS missing keyword \"new\"');                                                          // 31\n  }                                                                                                                    // 32\n                                                                                                                       //\n  if (!options.mongoUrl) {                                                                                             // 34\n    options.mongoUrl = process.env.MONGO_URL; // When using a Meteor MongoDB instance, preface name with \"cfs_gridfs.\"\n                                                                                                                       //\n    gridfsName = \"cfs_gridfs.\" + name;                                                                                 // 37\n  }                                                                                                                    // 38\n                                                                                                                       //\n  if (!options.mongoOptions) {                                                                                         // 40\n    options.mongoOptions = {                                                                                           // 41\n      db: {                                                                                                            // 41\n        native_parser: true                                                                                            // 41\n      },                                                                                                               // 41\n      server: {                                                                                                        // 41\n        auto_reconnect: true                                                                                           // 41\n      }                                                                                                                // 41\n    };                                                                                                                 // 41\n  }                                                                                                                    // 42\n                                                                                                                       //\n  if (options.chunkSize) {                                                                                             // 44\n    chunkSize = options.chunkSize;                                                                                     // 45\n  }                                                                                                                    // 46\n                                                                                                                       //\n  return new FS.StorageAdapter(name, options, {                                                                        // 48\n    typeName: \"storage.gridfs\",                                                                                        // 50\n    fileKey: function (fileObj) {                                                                                      // 51\n      // We should not have to mount the file here - We assume its taken                                               // 52\n      // care of - Otherwise we create new files instead of overwriting                                                // 53\n      var key = {                                                                                                      // 54\n        _id: null,                                                                                                     // 55\n        filename: null                                                                                                 // 56\n      }; // If we're passed a fileObj, we retrieve the _id and filename from it.                                       // 54\n                                                                                                                       //\n      if (fileObj) {                                                                                                   // 60\n        var info = fileObj._getInfo(name, {                                                                            // 61\n          updateFileRecordFirst: false                                                                                 // 61\n        });                                                                                                            // 61\n                                                                                                                       //\n        key._id = info.key || null;                                                                                    // 62\n        key.filename = info.name || fileObj.name({                                                                     // 63\n          updateFileRecordFirst: false                                                                                 // 63\n        }) || fileObj.collectionName + \"-\" + fileObj._id;                                                              // 63\n      } // If key._id is null at this point, createWriteStream will let GridFS generate a new ID                       // 64\n                                                                                                                       //\n                                                                                                                       //\n      return key;                                                                                                      // 67\n    },                                                                                                                 // 68\n    createReadStream: function (fileKey, options) {                                                                    // 69\n      options = options || {}; // Init GridFS                                                                          // 70\n                                                                                                                       //\n      var gfs = new Grid(self.db, mongodb); // Set the default streamning settings                                     // 73\n                                                                                                                       //\n      var settings = {                                                                                                 // 76\n        _id: new ObjectID(fileKey._id),                                                                                // 77\n        root: gridfsName                                                                                               // 78\n      }; // Check if this should be a partial read                                                                     // 76\n                                                                                                                       //\n      if (typeof options.start !== \"undefined\" && typeof options.end !== \"undefined\") {                                // 82\n        // Add partial info                                                                                            // 83\n        settings.range = {                                                                                             // 84\n          startPos: options.start,                                                                                     // 85\n          endPos: options.end                                                                                          // 86\n        };                                                                                                             // 84\n      }                                                                                                                // 88\n                                                                                                                       //\n      FS.debug && console.log(\"GRIDFS\", settings);                                                                     // 90\n      return gfs.createReadStream(settings);                                                                           // 92\n    },                                                                                                                 // 93\n    createWriteStream: function (fileKey, options) {                                                                   // 94\n      options = options || {}; // Init GridFS                                                                          // 95\n                                                                                                                       //\n      var gfs = new Grid(self.db, mongodb);                                                                            // 98\n      var opts = {                                                                                                     // 100\n        filename: fileKey.filename,                                                                                    // 101\n        mode: \"w\",                                                                                                     // 102\n        root: gridfsName,                                                                                              // 103\n        chunk_size: options.chunk_size || chunkSize,                                                                   // 104\n        // We allow aliases, metadata and contentType to be passed in via                                              // 105\n        // options                                                                                                     // 106\n        aliases: options.aliases || [],                                                                                // 107\n        metadata: options.metadata || null,                                                                            // 108\n        content_type: options.contentType || \"application/octet-stream\"                                                // 109\n      };                                                                                                               // 100\n                                                                                                                       //\n      if (fileKey._id) {                                                                                               // 112\n        opts._id = new ObjectID(fileKey._id);                                                                          // 113\n      }                                                                                                                // 114\n                                                                                                                       //\n      var writeStream = gfs.createWriteStream(opts);                                                                   // 116\n      writeStream.on(\"close\", function (file) {                                                                        // 118\n        if (!file) {                                                                                                   // 119\n          // gridfs-stream will emit \"close\" without passing a file                                                    // 120\n          // if there is an error. We can simply exit here because                                                     // 121\n          // the \"error\" listener will also be called in this case.                                                    // 122\n          return;                                                                                                      // 123\n        }                                                                                                              // 124\n                                                                                                                       //\n        if (FS.debug) console.log(\"SA GridFS - DONE!\"); // Emit end and return the fileKey, size, and updated date     // 126\n                                                                                                                       //\n        writeStream.emit(\"stored\", {                                                                                   // 129\n          // Set the generated _id so that we know it for future reads and writes.                                     // 130\n          // We store the _id as a string and only convert to ObjectID right before                                    // 131\n          // reading, writing, or deleting. If we store the ObjectID itself,                                           // 132\n          // Meteor (EJSON?) seems to convert it to a LocalCollection.ObjectID,                                        // 133\n          // which GFS doesn't understand.                                                                             // 134\n          fileKey: file._id.toString(),                                                                                // 135\n          size: file.length,                                                                                           // 136\n          storedAt: file.uploadDate || new Date()                                                                      // 137\n        });                                                                                                            // 129\n      });                                                                                                              // 139\n      writeStream.on(\"error\", function (error) {                                                                       // 141\n        console.log(\"SA GridFS - ERROR!\", error);                                                                      // 142\n      });                                                                                                              // 143\n      return writeStream;                                                                                              // 145\n    },                                                                                                                 // 146\n    remove: function (fileKey, callback) {                                                                             // 147\n      // Init GridFS                                                                                                   // 148\n      var gfs = new Grid(self.db, mongodb);                                                                            // 149\n                                                                                                                       //\n      try {                                                                                                            // 151\n        gfs.remove({                                                                                                   // 152\n          _id: new ObjectID(fileKey._id),                                                                              // 152\n          root: gridfsName                                                                                             // 152\n        }, callback);                                                                                                  // 152\n      } catch (err) {                                                                                                  // 153\n        callback(err);                                                                                                 // 154\n      }                                                                                                                // 155\n    },                                                                                                                 // 156\n    // Not implemented                                                                                                 // 158\n    watch: function () {                                                                                               // 159\n      throw new Error(\"GridFS storage adapter does not support the sync option\");                                      // 160\n    },                                                                                                                 // 161\n    init: function (callback) {                                                                                        // 163\n      mongodb.MongoClient.connect(options.mongoUrl, mongoOptions, function (err, db) {                                 // 164\n        if (err) {                                                                                                     // 165\n          return callback(err);                                                                                        // 165\n        }                                                                                                              // 165\n                                                                                                                       //\n        self.db = db;                                                                                                  // 166\n        callback(null);                                                                                                // 167\n      });                                                                                                              // 168\n    }                                                                                                                  // 169\n  });                                                                                                                  // 48\n};                                                                                                                     // 171\n/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},{\"extensions\":[\".js\",\".json\"]});\nrequire(\"./node_modules/meteor/cfs:gridfs/gridfs.server.js\");\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['cfs:gridfs'] = {};\n\n})();\n","servePath":"/packages/cfs_gridfs.js","sourceMap":{"version":3,"sources":["/packages/cfs:gridfs/gridfs.server.js"],"names":["path","Npm","require","mongodb","ObjectID","Grid","chunkSize","FS","Store","GridFS","name","options","self","gridfsName","mongoOptions","Error","mongoUrl","process","env","MONGO_URL","db","native_parser","server","auto_reconnect","StorageAdapter","typeName","fileKey","fileObj","key","_id","filename","info","_getInfo","updateFileRecordFirst","collectionName","createReadStream","gfs","settings","root","start","end","range","startPos","endPos","debug","console","log","createWriteStream","opts","mode","chunk_size","aliases","metadata","content_type","contentType","writeStream","on","file","emit","toString","size","length","storedAt","uploadDate","Date","error","remove","callback","err","watch","init","MongoClient","connect"],"mappings":"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","file":"/packages/cfs_gridfs.js","sourcesContent":["/* eslint-disable */\nconst path = Npm.require(\"path\");\nconst mongodb = Npm.require(\"mongodb\");\nconst ObjectID = Npm.require(\"mongodb\").ObjectID;\nconst Grid = Npm.require(\"gridfs-stream\");\n// var Grid = Npm.require('gridfs-locking-stream');\n\nlet chunkSize = 1024 * 1024 * 2; // 256k is default GridFS chunk size, but performs terribly for largish files\n\n/**\n * @public\n * @constructor\n * @param {String} name - The store name\n * @param {Object} options\n * @param {Function} [options.beforeSave] - Function to run before saving a file from the server. The context of the function will be the `FS.File` instance we're saving. The function may alter its properties.\n * @param {Number} [options.maxTries=5] - Max times to attempt saving a file\n * @returns {FS.StorageAdapter} An instance of FS.StorageAdapter.\n *\n * Creates a GridFS store instance on the server. Inherits from FS.StorageAdapter\n * type.\n */\n\nFS.Store.GridFS = function (name, options) {\n  const self = this;\n  options = options || {};\n\n  let gridfsName = name;\n  const mongoOptions = options.mongoOptions || {};\n\n  if (!(self instanceof FS.Store.GridFS))    {\n    throw new Error('FS.Store.GridFS missing keyword \"new\"');\n  }\n\n  if (!options.mongoUrl) {\n    options.mongoUrl = process.env.MONGO_URL;\n    // When using a Meteor MongoDB instance, preface name with \"cfs_gridfs.\"\n    gridfsName = \"cfs_gridfs.\" + name;\n  }\n\n  if (!options.mongoOptions) {\n    options.mongoOptions = { db: { native_parser: true }, server: { auto_reconnect: true } };\n  }\n\n  if (options.chunkSize) {\n    chunkSize = options.chunkSize;\n  }\n\n  return new FS.StorageAdapter(name, options, {\n\n    typeName: \"storage.gridfs\",\n    fileKey: function (fileObj) {\n      // We should not have to mount the file here - We assume its taken\n      // care of - Otherwise we create new files instead of overwriting\n      const key = {\n        _id: null,\n        filename: null\n      };\n\n      // If we're passed a fileObj, we retrieve the _id and filename from it.\n      if (fileObj) {\n        const info = fileObj._getInfo(name, { updateFileRecordFirst: false });\n        key._id = info.key || null;\n        key.filename = info.name || fileObj.name({ updateFileRecordFirst: false }) || (fileObj.collectionName + \"-\" + fileObj._id);\n      }\n\n      // If key._id is null at this point, createWriteStream will let GridFS generate a new ID\n      return key;\n    },\n    createReadStream: function (fileKey, options) {\n      options = options || {};\n\n      // Init GridFS\n      const gfs = new Grid(self.db, mongodb);\n\n      // Set the default streamning settings\n      const settings = {\n        _id: new ObjectID(fileKey._id),\n        root: gridfsName\n      };\n\n      // Check if this should be a partial read\n      if (typeof options.start !== \"undefined\" && typeof options.end !== \"undefined\") {\n        // Add partial info\n        settings.range = {\n          startPos: options.start,\n          endPos: options.end\n        };\n      }\n\n      FS.debug && console.log(\"GRIDFS\", settings);\n\n      return gfs.createReadStream(settings);\n    },\n    createWriteStream: function (fileKey, options) {\n      options = options || {};\n\n      // Init GridFS\n      const gfs = new Grid(self.db, mongodb);\n\n      const opts = {\n        filename: fileKey.filename,\n        mode: \"w\",\n        root: gridfsName,\n        chunk_size: options.chunk_size || chunkSize,\n        // We allow aliases, metadata and contentType to be passed in via\n        // options\n        aliases: options.aliases || [],\n        metadata: options.metadata || null,\n        content_type: options.contentType || \"application/octet-stream\"\n      };\n\n      if (fileKey._id) {\n        opts._id = new ObjectID(fileKey._id);\n      }\n\n      const writeStream = gfs.createWriteStream(opts);\n\n      writeStream.on(\"close\", function (file) {\n        if (!file) {\n          // gridfs-stream will emit \"close\" without passing a file\n          // if there is an error. We can simply exit here because\n          // the \"error\" listener will also be called in this case.\n          return;\n        }\n\n        if (FS.debug) console.log(\"SA GridFS - DONE!\");\n\n        // Emit end and return the fileKey, size, and updated date\n        writeStream.emit(\"stored\", {\n          // Set the generated _id so that we know it for future reads and writes.\n          // We store the _id as a string and only convert to ObjectID right before\n          // reading, writing, or deleting. If we store the ObjectID itself,\n          // Meteor (EJSON?) seems to convert it to a LocalCollection.ObjectID,\n          // which GFS doesn't understand.\n          fileKey: file._id.toString(),\n          size: file.length,\n          storedAt: file.uploadDate || new Date()\n        });\n      });\n\n      writeStream.on(\"error\", function (error) {\n        console.log(\"SA GridFS - ERROR!\", error);\n      });\n\n      return writeStream;\n    },\n    remove: function (fileKey, callback) {\n      // Init GridFS\n      const gfs = new Grid(self.db, mongodb);\n\n      try {\n        gfs.remove({ _id: new ObjectID(fileKey._id), root: gridfsName }, callback);\n      } catch (err) {\n        callback(err);\n      }\n    },\n\n    // Not implemented\n    watch: function () {\n      throw new Error(\"GridFS storage adapter does not support the sync option\");\n    },\n\n    init: function (callback) {\n      mongodb.MongoClient.connect(options.mongoUrl, mongoOptions, function (err, db) {\n        if (err) { return callback(err); }\n        self.db = db;\n        callback(null);\n      });\n    }\n  });\n};\n"]}}]